<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>jQuery Geo local sandbox tests</title>
  <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
  <meta name="description" content="Test all of the things!">
  <meta name="author" content="Ryan Westphal">

  <style type="text/css">

    #map
    {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }

  </style>
</head>
<body>
  <div id="map">
  </div>

  <script src="http://code.jquery.com/jquery-1.11.2.js"></script>

  <script src="../js/excanvas.js"></script>
  <script src="../js/jsrender.js"></script>
  <script src="../js/jquery.mousewheel.js"></script>
  <script src="../js/jquery.ui.widget.js"></script>
  <script src="../js/jquery.geo.core.js"></script>
  <script src="../js/jquery.geo.geographics.js"></script>
  <script src="../js/jquery.geo.geomap.js"></script>
  <script src="../js/jquery.geo.tiled.js"></script>
  <script src="../js/jquery.geo.shingled.js"></script>
  <!--<script src="../dist/jquery.geo-1.0.0-test.min.js"></script>-->

  <script>
    $.geo.proj = null;

    var haveImage = false;

    var img = new Image();
    img.onload = function( ) {
      haveImage = true;
      var bboxMax = [ 0, 0, img.width, img.height ];
      $( '#map' ).geomap( 'option', 'bboxMax', bboxMax );
      setTimeout( function( ) { $( '#map' ).geomap( 'option', 'bbox', bboxMax ); }, 30 );
    };
    img.crossOrigin = 'anonymous';
    img.src = 'http://test.jquerygeo.com/stjames.jpg';

    var viewCanvas = $( '<canvas width="128" height="128" />' );
    var viewContext = viewCanvas[0].getContext( '2d' );

    $(function() {
      // create a map
      var map = $("#map").geomap({
        bboxMax: [ 0, 0, 128, 128 ],
        axisLayout: 'image',
        tilingScheme: null,
        services: [ {
          type: 'shingled',
          shinglesMax: 2,
          src: function( view ) {
            if ( !haveImage ) {
              return '';
            }

            viewContext.canvas.width = view.width;
            viewContext.canvas.height = view.height; 
            viewContext.drawImage( img, view.bbox[0], view.bbox[1], $.geo.width( view.bbox ), $.geo.height( view.bbox ), 0, 0, view.width, view.height );

            return viewCanvas[0].toDataURL( 'image/png' );
          }
        } ]
      });
    });
  </script>
</body>
</html>

