/*! jQuery Geo - v1.0.0-test - 2013-05-13
* http://jquerygeo.com
* Copyright (c) 2013 Ryan Westphal; Licensed MIT, GPL */
document.createElement("canvas").getContext||function(){function t(){return this.context_||(this.context_=new f(this))}function e(t,e){var i=k.call(arguments,2);return function(){return t.apply(e,i.concat(k.call(arguments)))}}function i(t,e,i){t.namespaces[e]||t.namespaces.add(e,i,"#default#VML")}function s(t){if(i(t,"g_vml_","urn:schemas-microsoft-com:vml"),i(t,"g_o_","urn:schemas-microsoft-com:office:office"),!t.styleSheets.ex_canvas_){var e=t.createStyleSheet();e.owningElement.id="ex_canvas_",e.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function n(t){var e=t.srcElement;switch(t.propertyName){case"width":e.getContext().clearRect(),e.style.width=e.attributes.width.nodeValue+"px",e.firstChild.style.width=e.clientWidth+"px";break;case"height":e.getContext().clearRect(),e.style.height=e.attributes.height.nodeValue+"px",e.firstChild.style.height=e.clientHeight+"px"}}function r(t){var e=t.srcElement;e.firstChild&&(e.firstChild.style.width=e.clientWidth+"px",e.firstChild.style.height=e.clientHeight+"px")}function o(){return[[1,0,0],[0,1,0],[0,0,1]]}function a(t,e){for(var i=o(),s=0;3>s;s++)for(var n=0;3>n;n++){for(var r=0,a=0;3>a;a++)r+=t[s][a]*e[a][n];i[s][n]=r}return i}function h(t,e){e.fillStyle=t.fillStyle,e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.shadowBlur=t.shadowBlur,e.shadowColor=t.shadowColor,e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY,e.strokeStyle=t.strokeStyle,e.globalAlpha=t.globalAlpha,e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.arcScaleX_=t.arcScaleX_,e.arcScaleY_=t.arcScaleY_,e.lineScale_=t.lineScale_}function c(t){var e=t.indexOf("(",3),i=t.indexOf(")",e+1),s=t.substring(e+1,i).split(",");return(4!=s.length||"a"!=t.charAt(3))&&(s[3]=1),s}function l(t){return parseFloat(t)/100}function u(t,e,i){return Math.min(i,Math.max(e,t))}function _(t){var e,i,s,n,r,o;if(n=parseFloat(t[0])/360%360,0>n&&n++,r=u(l(t[1]),0,1),o=u(l(t[2]),0,1),0==r)e=i=s=o;else{var a=.5>o?o*(1+r):o+r-o*r,h=2*o-a;e=d(h,a,n+1/3),i=d(h,a,n),s=d(h,a,n-1/3)}return"#"+O[Math.floor(255*e)]+O[Math.floor(255*i)]+O[Math.floor(255*s)]}function d(t,e,i){return 0>i&&i++,i>1&&i--,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}function p(t){if(t in G)return G[t];var e,i=1;if(t+="","#"==t.charAt(0))e=t;else if(/^rgb/.test(t)){for(var s,n=c(t),e="#",r=0;3>r;r++)s=-1!=n[r].indexOf("%")?Math.floor(255*l(n[r])):+n[r],e+=O[u(s,0,255)];i=+n[3]}else if(/^hsl/.test(t)){var n=c(t);e=_(n),i=n[3]}else e=t;return G[t]={color:e,alpha:i}}function g(t){return j[t]||"square"}function f(t){this.m_=o(),this.mStack_=[],this.aStack_=[],this.currentPath_=[],this.strokeStyle="#000",this.fillStyle="#000",this.lineWidth=1,this.lineJoin="miter",this.lineCap="butt",this.miterLimit=1*I,this.globalAlpha=1,this.canvas=t;var e="width:"+t.clientWidth+"px;height:"+t.clientHeight+"px;overflow:hidden;position:absolute",i=t.ownerDocument.createElement("div");i.style.cssText=e,t.appendChild(i);var s=i.cloneNode(!1);s.style.backgroundColor="red",s.style.filter="alpha(opacity=0)",t.appendChild(s),this.element_=i,this.arcScaleX_=1,this.arcScaleY_=1,this.lineScale_=1}function m(t,e,i,s){t.currentPath_.push({type:"bezierCurveTo",cp1x:e.x,cp1y:e.y,cp2x:i.x,cp2y:i.y,x:s.x,y:s.y}),t.currentX_=s.x,t.currentY_=s.y}function v(t,e){var i=p(t.strokeStyle),s=i.color,n=i.alpha*t.globalAlpha,r=t.lineScale_*t.lineWidth;1>r&&(n*=r),e.push("<g_vml_:stroke",' opacity="',n,'"',' joinstyle="',t.lineJoin,'"',' miterlimit="',t.miterLimit,'"',' endcap="',g(t.lineCap),'"',' weight="',r,'px"',' color="',s,'" />')}function x(t,e,i,s){t.fillStyle,t.arcScaleX_,t.arcScaleY_,s.x-i.x,s.y-i.y;var n=p(t.fillStyle),r=n.color,o=n.alpha*t.globalAlpha;e.push('<g_vml_:fill color="',r,'" opacity="',o,'" />')}function y(t,e,i){var s=t.m_;return{x:I*(e*s[0][0]+i*s[1][0]+s[2][0])-z,y:I*(e*s[0][1]+i*s[1][1]+s[2][1])-z}}function w(t){return isFinite(t[0][0])&&isFinite(t[0][1])&&isFinite(t[1][0])&&isFinite(t[1][1])&&isFinite(t[2][0])&&isFinite(t[2][1])}function b(t,e,i){if(w(e)&&(t.m_=e,i)){var s=e[0][0]*e[1][1]-e[0][1]*e[1][0];t.lineScale_=$(P(s))}}function S(t){this.code=this[t],this.message=t+": DOM Exception "+this.code}var A=Math,C=A.round,T=A.sin,M=A.cos,P=A.abs,$=A.sqrt,I=10,z=I/2;+navigator.userAgent.match(/MSIE ([\d.]+)?/)[1];var k=Array.prototype.slice;s(document);var E={init:function(t){var i=t||document;i.createElement("canvas"),i.attachEvent("onreadystatechange",e(this.init_,this,i))},init_:function(t){for(var e=t.getElementsByTagName("canvas"),i=0;e.length>i;i++)this.initElement(e[i])},initElement:function(e){if(!e.getContext){e.getContext=t,s(e.ownerDocument),e.innerHTML="",e.attachEvent("onpropertychange",n),e.attachEvent("onresize",r);var i=e.attributes;i.width&&i.width.specified?e.style.width=i.width.nodeValue+"px":e.width=e.clientWidth,i.height&&i.height.specified?e.style.height=i.height.nodeValue+"px":e.height=e.clientHeight}return e}};E.init();for(var O=[],L=0;16>L;L++)for(var D=0;16>D;D++)O[16*L+D]=L.toString(16)+D.toString(16);var G={},j={butt:"flat",round:"round"},B=f.prototype;B.clearRect=function(){this.textMeasureEl_&&(this.textMeasureEl_.removeNode(!0),this.textMeasureEl_=null),this.element_.innerHTML=""},B.beginPath=function(){this.currentPath_=[]},B.moveTo=function(t,e){var i=y(this,t,e);this.currentPath_.push({type:"moveTo",x:i.x,y:i.y}),this.currentX_=i.x,this.currentY_=i.y},B.lineTo=function(t,e){var i=y(this,t,e);this.currentPath_.push({type:"lineTo",x:i.x,y:i.y}),this.currentX_=i.x,this.currentY_=i.y},B.bezierCurveTo=function(t,e,i,s,n,r){var o=y(this,n,r),a=y(this,t,e),h=y(this,i,s);m(this,a,h,o)},B.quadraticCurveTo=function(t,e,i,s){var n=y(this,t,e),r=y(this,i,s),o={x:this.currentX_+2/3*(n.x-this.currentX_),y:this.currentY_+2/3*(n.y-this.currentY_)},a={x:o.x+(r.x-this.currentX_)/3,y:o.y+(r.y-this.currentY_)/3};m(this,o,a,r)},B.arc=function(t,e,i,s,n,r){i*=I;var o=r?"at":"wa",a=t+M(s)*i-z,h=e+T(s)*i-z,c=t+M(n)*i-z,l=e+T(n)*i-z;a!=c||r||(a+=.125);var u=y(this,t,e),_=y(this,a,h),d=y(this,c,l);this.currentPath_.push({type:o,x:u.x,y:u.y,radius:i,xStart:_.x,yStart:_.y,xEnd:d.x,yEnd:d.y})},B.stroke=function(t){var e=[],i=10,s=10;e.push("<g_vml_:shape",' filled="',!!t,'"',' style="position:absolute;width:',i,"px;height:",s,'px;"',' coordorigin="0,0"',' coordsize="',I*i,",",I*s,'"',' stroked="',!t,'"',' path="');for(var n={x:null,y:null},r={x:null,y:null},o=0;this.currentPath_.length>o;o++){var a,h=this.currentPath_[o];switch(h.type){case"moveTo":a=h,e.push(" m ",C(h.x),",",C(h.y));break;case"lineTo":e.push(" l ",C(h.x),",",C(h.y));break;case"close":e.push(" x "),h=null;break;case"bezierCurveTo":e.push(" c ",C(h.cp1x),",",C(h.cp1y),",",C(h.cp2x),",",C(h.cp2y),",",C(h.x),",",C(h.y));break;case"at":case"wa":e.push(" ",h.type," ",C(h.x-this.arcScaleX_*h.radius),",",C(h.y-this.arcScaleY_*h.radius)," ",C(h.x+this.arcScaleX_*h.radius),",",C(h.y+this.arcScaleY_*h.radius)," ",C(h.xStart),",",C(h.yStart)," ",C(h.xEnd),",",C(h.yEnd))}h&&((null==n.x||h.x<n.x)&&(n.x=h.x),(null==r.x||h.x>r.x)&&(r.x=h.x),(null==n.y||h.y<n.y)&&(n.y=h.y),(null==r.y||h.y>r.y)&&(r.y=h.y))}e.push(' ">'),t?x(this,e,n,r):v(this,e),e.push("</g_vml_:shape>"),this.element_.insertAdjacentHTML("beforeEnd",e.join(""))},B.fill=function(){this.stroke(!0)},B.closePath=function(){this.currentPath_.push({type:"close"})},B.save=function(){var t={};h(this,t),this.aStack_.push(t),this.mStack_.push(this.m_),this.m_=a(o(),this.m_)},B.restore=function(){this.aStack_.length&&(h(this.aStack_.pop(),this),this.m_=this.mStack_.pop())},B.translate=function(t,e){var i=[[1,0,0],[0,1,0],[t,e,1]];b(this,a(i,this.m_),!1)},B.scale=function(t,e){this.arcScaleX_*=t,this.arcScaleY_*=e;var i=[[t,0,0],[0,e,0],[0,0,1]];b(this,a(i,this.m_),!0)};var R=S.prototype=Error();R.INDEX_SIZE_ERR=1,R.DOMSTRING_SIZE_ERR=2,R.HIERARCHY_REQUEST_ERR=3,R.WRONG_DOCUMENT_ERR=4,R.INVALID_CHARACTER_ERR=5,R.NO_DATA_ALLOWED_ERR=6,R.NO_MODIFICATION_ALLOWED_ERR=7,R.NOT_FOUND_ERR=8,R.NOT_SUPPORTED_ERR=9,R.INUSE_ATTRIBUTE_ERR=10,R.INVALID_STATE_ERR=11,R.SYNTAX_ERR=12,R.INVALID_MODIFICATION_ERR=13,R.NAMESPACE_ERR=14,R.INVALID_ACCESS_ERR=15,R.VALIDATION_ERR=16,R.TYPE_MISMATCH_ERR=17,G_vmlCanvasManager=E,CanvasRenderingContext2D=f,DOMException=S}(),this.jsviews||this.jQuery&&jQuery.views||function(t,e){function i(t,e){var i="\\"+t.charAt(0),s="\\"+t.charAt(1),n="\\"+e.charAt(0),r="\\"+e.charAt(1);return N.rTag=y=s+"(?:(?:(\\w+(?=[\\/\\s"+n+"]))|(?:(\\w+)?(:)|(>)|(\\*)))"+"\\s*((?:[^"+n+"]|"+n+"(?!"+r+"))*?)"+"(\\/)?|(?:\\/(\\w+)))"+n,y=RegExp(i+y+r,"g"),w=RegExp("<.*>|"+t+".*"+e),this}function s(t){var i=this,s=i.tmpl.helpers||{};return t=(i.ctx[t]!==e?i.ctx:s[t]!==e?s:l[t]!==e?l:{})[t],"function"!=typeof t?t:function(){return t.apply(i,arguments)}}function n(t,e,i){var s=e.tmpl.converters;return t=s&&s[t]||u[t],t?t.call(e,i):i}function r(t,i,s,n,r){r.props=r.props||{};var o,a=r.props.tmpl,l=i.tmpl.tags,u=i.tmpl.templates,d=arguments,p=l&&l[t]||c[t];return p?(n=n&&i.tmpl.tmpls[n-1],a=a||n||e,r.tmpl=""+a===a?u&&u[a]||h[a]||h(a):a,r.isTag=T,r.converter=s,r.view=i,r.renderContent=_,i.ctx&&b(r.ctx,i.ctx),o=p.apply(r,d.length>5?R.call(d,5):[]),o||(o==e?"":""+o)):""}function o(t,i,n,r,o,a){var h=n.views,c={tmpl:o,path:i,parent:n,data:r,ctx:t,views:x.isArray(r)?[]:{},hlp:s};return x.isArray(h)?h.splice(c.index=a!==e?a:h.length,0,c):h[c.index="_"+O++]=c,c}function a(t,i,s,n,r){var o,a;if(s&&"object"==typeof s&&!s.nodeType){for(o in s)i(o,s[o]);return t}return s&&n!==e?""+s===s&&(null===n?delete i[s]:(n=r?r(s,n):n)&&(i[s]=n)):r&&(n=r(e,n||s)),(a=A.onStoreItem)&&a(i,s,n,r),n}function h(t,e){return a(this,h,t,e,f)}function c(t,e){return a(this,c,t,e)}function l(t,e){return a(this,l,t,e)}function u(t,e){return a(this,u,t,e)}function _(t,i,s,n,r){var a,c,l,u,_,d,p,g,f,m,v={},y=r===T,w=this,S="";if(w.isTag?(f=w.tmpl,i=i||w.ctx,s=s||w.view,n=n||w.path,r=r||w.index,v=w.props):f=w.jquery&&w[0]||w,s=s||N.topView,g=s.ctx,m=f.layout,t===s&&(t=s.data,m=T),i=i&&i===g?g:g?(g=b({},g),i?b(g,i):g):i||{},v.link===C&&(i.link=C),f.fn||(f=h[f]||h(f)),_=i.link&&A.onRenderItem,d=i.link&&A.onRenderItems,f){if(x.isArray(t)&&!m)for(u=y?s:r!==e&&s||o(i,n,s,t,f,r),a=0,c=t.length;c>a;a++)l=t[a],p=f.fn(l,o(i,n,u,l,f,(r||0)+a),N),S+=_?_(p,v):p;else u=y?s:o(i,n,s,t,f,r),S+=t||m?f.fn(t,u,N):"";return s.topKey=u.index,d?d(S,n,u.index,f,v):S}return""}function d(){throw"Syntax error"}function p(t,e,i){function s(e){e-=$,e&&L.push(t.substr($,e).replace(I,"\\n"))}function n(e,n,o,a,h,c,l,u,_,d){h&&(a=":",o="html");var p="",f="",m=!u&&!a;if(n=n||a,s(d),$=d+e.length,c?A&&L.push(["*",l.replace(z,"$1")]):n?("else"===n&&(D[5]=t.substring(D[5],d),D=O.pop(),L=D[3],m=T),l=l?g(l,i).replace(E,function(t,e,i){return e?f+=i+",":p+=i+",",""}):"",p=p.slice(0,-1),l=l.slice(0,-1),r=[n,o||"",l,m&&[],"{"+(p?"props:{"+p+"},":"")+"path:'"+l+"'"+(f?",ctx:{"+f.slice(0,-1)+"}":"")+"}"],m&&(O.push(D),D=r,D[5]=$),L.push(r)):_&&(D[5]=t.substring(D[5],d),D=O.pop()),!D)throw"Expected block tag";L=D[3]}var r,o,a,h,c,l,u,_,d,f,v,x,w,b,S,A,C=e?{allowCode:A=e.allowCode,debug:e.debug}:{},M=e&&e.tmpls,P=[],$=0,O=[],L=P,D=[,,,P],G=0;for(t=t.replace(k,"\\$1"),t.replace(y,n),s(t.length),h=P.length,c=h?"":'"";',a=0;h>a;a++)o=P[a],"*"===o[0]?c=c.slice(0,a?-1:-3)+";"+o[1]+(h>a+1?"ret+=":""):""+o===o?c+='"'+o+'"+':(v=o[0],x=o[1],w=o[2],L=o[3],b=o[4],t=o[5],L&&(S=m(t,C,e,G++),p(t,S),M.push(S)),f=f||b.indexOf("view")>-1,c+=(":"===v?"html"===x?(u=T,"e("+w):x?(d=T,'c("'+x+'",view,'+w):(_=T,"((v="+w+')!=u?v:""'):(l=T,'t("'+v+'",view,"'+(x||"")+'",'+(L?M.length:'""')+","+b+(w?",":"")+w))+")+");return c=Function("data, view, j, b, u",j+(_?"v,":"")+(l?"t=j.tag,":"")+(d?"c=j.convert,":"")+(u?"e=j.converters.html,":"")+"ret; try{\n\n"+(C.debug?"debugger;":"")+(A?"ret=":"return ")+c.slice(0,-1)+";\n\n"+(A?"return ret;":"")+"}catch(e){return j.err(e);}"),e&&(e.fn=c,e.useVw=d||f||l),c}function g(t,i){function s(t,s,c,l,u,_,p,g,f,m,v,x,y,w,b,S){function A(t,e,s,n,r,o,a){if(e){var h=(s?'view.hlp("'+s+'")':n?"view":"data")+(a?(r?"."+r:s?"":n?"":"."+e)+(o||""):(a=s?"":n?r||"":e,""));return i&&"("!==f&&(h="b("+h+',"'+a+'")'),h+(a?"."+a:"")}return t}return u=u||"",c=c||s||v,l=l||g,f=f||b||"",u=u||"",_?(d(),e):h?(h=!x,h?t:'"'):a?(a=!y,a?t:'"'):(c?(o++,c):"")+(S?o?"":n?(n=C,"\b"):",":p?(o&&d(),n=T,"\b"+l+":"):l?l.replace(P,A)+(f?(r[++o]=T,f):u):u?t:w?(r[o--]=C,w+(f?(r[++o]=T,f):"")):m?(r[o]||d(),","):s?"":(h=x,a=y,'"'))}var n,r={},o=0,a=C,h=C;return t=(t+" ").replace($,s)}function f(t,i,s,n){function r(i){return""+i===i||i.nodeType>0?(a=i.nodeType>0?i:!w.test(i)&&M&&M(i)[0],a&&a.type&&(i=h[a.getAttribute(G)],i||(t=t||"_"+L++,a.setAttribute(G,t),i=f(t,a.innerHTML,s,n),h[t]=i)),i):e}var o,a,c,l,u;if(o=r(i),n=n||(i.markup?i:{}),n.name=t,l=n.templates,!o&&i.markup&&(o=r(i.markup))&&(!o.fn||o.debug===i.debug&&o.allowCode===i.allowCode||(o=o.markup)),o!==e){t&&!s&&(F[t]=function(){return i.render.apply(i,arguments)}),o.fn||i.fn?o.fn&&(i=t&&t!==o.name?b(b({},o),n):o):(i=m(o,n,s,0),p(o,i));for(c in l)u=l[c],u.name!==c&&(l[c]=f(c,u,i));return i}}function m(t,e,i,s){function n(t){i[t]&&(r[t]=b(b({},i[t]),e[t]))}e=e||{};var r={markup:t,tmpls:[],links:[],render:_};return i&&(i.templates&&(r.templates=b(b({},i.templates),e.templates)),r.parent=i,r.name=i.name+"["+s+"]",r.index=s),b(r,e),i&&(n("templates"),n("tags"),n("helpers"),n("converters")),r}function v(t){return D[t]||(D[t]="&#"+t.charCodeAt(0)+";")}var x,y,w,b,S="v1.0pre",A={},C=!1,T=!0,M=t.jQuery,P=/^(?:null|true|false|\d[\d.]*|([\w$]+|~([\w$]+)|#(view|([\w$]+))?)([\w$.]*?)(?:[.[]([\w$]+)\]?)?|(['"]).*\8)$/g,$=/(\()(?=|\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*([)\]])([([]?))|(\s+)/g,I=/\r?\n/g,z=/\\(['"])/g,k=/\\?(['"])/g,E=/\x08(~)?([^\x08]+)\x08/g,O=0,L=0,D={"&":"&amp;","<":"&lt;",">":"&gt;"},G="data-jsv-tmpl",j="var j=j||"+(M?"jQuery.":"js")+"views,",B=/[\x00"&'<>]/g,R=Array.prototype.slice,F={},N={jsviews:S,sub:A,debugMode:T,err:function(t){return N.debugMode?"<br/><b>Error:</b> <em> "+(t.message||t)+". </em>":'""'},tmplFn:p,render:F,templates:h,tags:c,helpers:l,converters:u,View:o,convert:n,delimiters:i,tag:r};M?(x=M,x.templates=h,x.render=F,x.views=N,x.fn.render=_):(x=t.jsviews=N,x.extend=function(t,e){var i;t=t||{};for(i in e)t[i]=e[i];return t},x.isArray=Array&&Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}),b=x.extend,N.topView={views:{},tmpl:{},hlp:s,ctx:N.helpers},c({"if":function(){var t=this,i=t.view;return i.onElse=function(t,s){for(var n=0,r=s.length;r&&!s[n++];)if(n===r)return"";return i.onElse=e,t.path="",t.renderContent(i)},i.onElse(this,arguments)},"else":function(){var t=this.view;return t.onElse?t.onElse(this,arguments):""},"for":function(){var t,e=this,i="",s=arguments,n=s.length;for(e.props.layout&&(e.tmpl.layout=T),t=0;n>t;t++)i+=e.renderContent(s[t]);return i},"=":function(t){return t},"*":function(t){return t}}),u({html:function(t){return t!=e?(t+"").replace(B,v):""}}),i("{{","}}")}(this),function(t){function e(e){var i=e||window.event,s=[].slice.call(arguments,1),n=0,r=0,o=0;return e=t.event.fix(i),e.type="mousewheel",i.wheelDelta&&(n=i.wheelDelta/120),i.detail&&(n=-i.detail/3),o=n,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(o=0,r=-1*n),void 0!==i.wheelDeltaY&&(o=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(r=-1*i.wheelDeltaX/120),s.unshift(e,n,r,o),(t.event.dispatch||t.event.handle).apply(this,s)}var i=["DOMMouseScroll","mousewheel"];if(t.event.fixHooks)for(var s=i.length;s;)t.event.fixHooks[i[--s]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=i.length;t;)this.addEventListener(i[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=i.length;t;)this.removeEventListener(i[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}(jQuery),$.widget||function(t,e){if(t.cleanData){var i=t.cleanData;t.cleanData=function(e){for(var s,n=0;null!=(s=e[n]);n++)try{t(s).triggerHandler("remove")}catch(r){}i(e)}}else{var s=t.fn.remove;t.fn.remove=function(e,i){return this.each(function(){return i||(!e||t.filter(e,[this]).length)&&t("*",this).add([this]).each(function(){try{t(this).triggerHandler("remove")}catch(e){}}),s.call(t(this),e,i)})}}t.widget=function(e,i,s){var n,r=e.split(".")[0];e=e.split(".")[1],n=r+"-"+e,s||(s=i,i=t.Widget),t.expr[":"][n]=function(i){return!!t.data(i,e)},t[r]=t[r]||{},t[r][e]=function(t,e){arguments.length&&this._createWidget(t,e)};var o=new i;o.options=t.extend(!0,{},o.options),t[r][e].prototype=t.extend(!0,o,{namespace:r,widgetName:e,widgetEventPrefix:t[r][e].prototype.widgetEventPrefix||e,widgetBaseClass:n},s),t.widget.bridge(e,t[r][e])},t.widget.bridge=function(i,s){t.fn[i]=function(n){var r="string"==typeof n,o=Array.prototype.slice.call(arguments,1),a=this;return n=!r&&o.length?t.extend.apply(null,[!0,n].concat(o)):n,r&&"_"===n.charAt(0)?a:(r?this.each(function(){var s=t.data(this,i),r=s&&t.isFunction(s[n])?s[n].apply(s,o):s;return r!==s&&r!==e?(a=r,!1):e}):this.each(function(){var e=t.data(this,i);e?e.option(n||{})._init():t.data(this,i,new s(n,this))}),a)}},t.Widget=function(t,e){arguments.length&&this._createWidget(t,e)},t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(e,i){t.data(i,this.widgetName,this),this.element=t(i),this.options=t.extend(!0,{},this.options,this._getCreateOptions(),e);var s=this;this.element.bind("remove."+this.widgetName,function(){s.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(i,s){var n=i;if(0===arguments.length)return t.extend({},this.options);if("string"==typeof i){if(s===e)return this.options[i];n={},n[i]=s}return this._setOptions(n),this},_setOptions:function(e){var i=this;return t.each(e,function(t,e){i._setOption(t,e)}),this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&this.widget()[e?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",e),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(e,i,s){var n,r,o=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(n in r)n in i||(i[n]=r[n]);return this.element.trigger(i,s),!(t.isFunction(o)&&o.call(this.element[0],i,s)===!1||i.isDefaultPrevented())}}}(jQuery),function(t,e,i){var s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;t.geo={_allCoordinates:function(e){for(var i=this._flatten(e),s=0,n=[];i.length>s;s++){var r,o,a,h=i[s].coordinates,c=h&&t.isArray(h[0]),l=c&&t.isArray(h[0][0]),u=l&&t.isArray(h[0][0][0]);for(u||(l||(c||(h=[h]),h=[h]),h=[h]),r=0;h.length>r;r++)for(o=0;h[r].length>o;o++)for(a=0;h[r][o].length>a;a++)n.push(h[r][o][a])}return n},_isGeodetic:function(e){for(;t.isArray(e);){if(e.length>1&&!t.isArray(e[0]))return e[0]>=-180&&180>=e[0]&&e[1]>=-85&&85>=e[1];e=e[0]}return!1},center:function(e,i){var s=!1;!i&&t.geo.proj&&this._isGeodetic(e)&&(s=!0,e=t.geo.proj.fromGeodetic(e));var n=[(e[0]+e[2])/2,(e[1]+e[3])/2];return s?t.geo.proj.toGeodetic(n):n},expandBy:function(e,i,s,n){var r=!1;return!n&&t.geo.proj&&this._isGeodetic(e)&&(r=!0,e=t.geo.proj.fromGeodetic(e)),e=[e[0]-i,e[1]-s,e[2]+i,e[3]+s],r?t.geo.proj.toGeodetic(e):e},height:function(e,i){return!i&&t.geo.proj&&this._isGeodetic(e)&&(e=t.geo.proj.fromGeodetic(e)),e[3]-e[1]},_in:function(t,e){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[2]&&t[3]>=e[3]},_bboxDisjoint:function(t,e){return e[0]>t[2]||e[2]<t[0]||e[1]>t[3]||e[3]<t[1]},include:function(e,i,r){if(!i||!t.isArray(i))return e;var o=!1;return!r&&t.geo.proj&&this._isGeodetic(e||i)&&(o=!0),e?o&&(e=t.geo.proj.fromGeodetic(e)):e=[s,s,n,n],2===i.length&&(i=[i[0],i[1],i[0],i[1]]),i=t.geo.proj.fromGeodetic(i),e[0]=Math.min(i[0],e[0]),e[1]=Math.min(i[1],e[1]),e[2]=Math.max(i[2],e[2]),e[3]=Math.max(i[3],e[3]),o?t.geo.proj.toGeodetic(e):e},polygonize:function(e,i){var s=!1;!i&&t.geo.proj&&this._isGeodetic(e)&&(s=!0,e=t.geo.proj.fromGeodetic(e));var n={type:"Polygon",coordinates:[[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]]};return s&&(n.coordinates=t.geo.proj.toGeodetic(n.coordinates)),n},reaspect:function(e,i,s){var n=!1;!s&&t.geo.proj&&this._isGeodetic(e)&&(n=!0,e=t.geo.proj.fromGeodetic(e));var r,o,a=this.width(e,!0),h=this.height(e,!0),c=this.center(e,!0);return 0!==a&&0!==h&&i>0&&(a/h>i?(r=a/2,o=r/i):(o=h/2,r=o*i),e=[c[0]-r,c[1]-o,c[0]+r,c[1]+o]),n?t.geo.proj.toGeodetic(e):e},recenter:function(e,i,s){var n=!1;!s&&t.geo.proj&&(this._isGeodetic(e)&&(n=!0,e=t.geo.proj.fromGeodetic(e)),this._isGeodetic(i)&&(i=t.geo.proj.fromGeodetic(i)));var r=(e[2]-e[0])/2,o=(e[3]-e[1])/2;return e=[i[0]-r,i[1]-o,i[0]+r,i[1]+o],n?t.geo.proj.toGeodetic(e):e},scaleBy:function(e,i,s){var n=!1;!s&&t.geo.proj&&this._isGeodetic(e)&&(n=!0,e=t.geo.proj.fromGeodetic(e));var r=this.center(e,!0),o=(e[2]-e[0])*i/2,a=(e[3]-e[1])*i/2;return e=[r[0]-o,r[1]-a,r[0]+o,r[1]+a],n?t.geo.proj.toGeodetic(e):e},width:function(e,i){return!i&&t.geo.proj&&this._isGeodetic(e)&&(e=t.geo.proj.fromGeodetic(e)),e[2]-e[0]},bbox:function(e,r){var o,a=!1;if(!e)return i;if(e.bbox)o=!r&&t.geo.proj&&this._isGeodetic(e.bbox)?t.geo.proj.fromGeodetic(e.bbox):e.bbox;else{o=[s,s,n,n];var h=this._allCoordinates(e),c=0;if(0===h.length)return i;for(!r&&t.geo.proj&&this._isGeodetic(h)&&(a=!0,h=t.geo.proj.fromGeodetic(h));h.length>c;c++)o[0]=Math.min(h[c][0],o[0]),o[1]=Math.min(h[c][1],o[1]),o[2]=Math.max(h[c][0],o[2]),o[3]=Math.max(h[c][1],o[3])}return a?t.geo.proj.toGeodetic(o):o},centroid:function(e,r){switch(e.type){case"Point":return t.extend({},e);case"LineString":case"Polygon":var o,a,h=0,c=[0,0],l=t.merge([],"Polygon"===e.type?e.coordinates[0]:e.coordinates),u=1,_=[s,s,n,n],d=!1;for(!r&&t.geo.proj&&this._isGeodetic(l)&&(d=!0,l=t.geo.proj.fromGeodetic(l));l.length>=u;u++)o=u%l.length,_[0]=Math.min(l[o][0],_[0]),_[1]=Math.min(l[o][1],_[1]),_[2]=Math.max(l[o][0],_[2]),_[3]=Math.max(l[o][1],_[3]),a=l[u-1][0]*l[o][1]-l[o][0]*l[u-1][1],h+=a,c[0]+=(l[u-1][0]+l[o][0])*a,c[1]+=(l[u-1][1]+l[o][1])*a;return 0===h?l.length>0?(c[0]=Math.min(Math.max(l[0][0],_[0]),_[2]),c[1]=Math.min(Math.max(l[0][1],_[1]),_[3]),{type:"Point",coordinates:d?t.geo.proj.toGeodetic(c):c}):i:(h*=3,c[0]=Math.min(Math.max(c[0]/h,_[0]),_[2]),c[1]=Math.min(Math.max(c[1]/h,_[1]),_[3]),{type:"Point",coordinates:d?t.geo.proj.toGeodetic(c):c})}return i},contains:function(t,e){if("Polygon"!==t.type)return!1;switch(e.type){case"Point":return this._containsPolygonPoint(t.coordinates,e.coordinates);case"LineString":return this._containsPolygonLineString(t.coordinates,e.coordinates);case"Polygon":return this._containsPolygonLineString(t.coordinates,e.coordinates[0]);default:return!1}},_containsPolygonPoint:function(t,e){if(0===t.length||4>t[0].length)return!1;for(var i,s,n=0,r=t[0][0],o=1;t[0].length>o;o++)i=t[0][o],(r[1]<=e[1]&&e[1]<i[1]||i[1]<=e[1]&&e[1]<r[1]&&(e[0]<r[0]||e[0]<i[0]))&&(s=r[0]+(i[0]-r[0])*(e[1]-r[1])/(i[1]-r[1]),s>e[0]&&n++),r=i;return 1===n%2},_containsPolygonLineString:function(t,e){for(var i=0;e.length>i;i++)if(!this._containsPolygonPoint(t,e[i]))return!1;return!0},distance:function(e,s,n){var r=!n&&t.geo.proj&&this._isGeodetic(e.coordinates)?t.geo.proj.fromGeodetic(e.coordinates):e.coordinates,o=!n&&t.geo.proj&&this._isGeodetic(s.coordinates)?t.geo.proj.fromGeodetic(s.coordinates):s.coordinates;switch(e.type){case"Point":switch(s.type){case"Point":return this._distancePointPoint(o,r);case"LineString":return this._distanceLineStringPoint(o,r);case"Polygon":return this._containsPolygonPoint(o,r)?0:this._distanceLineStringPoint(o[0],r);default:return i}break;case"LineString":switch(s.type){case"Point":return this._distanceLineStringPoint(r,o);case"LineString":return this._distanceLineStringLineString(r,o);case"Polygon":return this._containsPolygonLineString(o,r)?0:this._distanceLineStringLineString(o[0],r);default:return i}break;case"Polygon":switch(s.type){case"Point":return this._containsPolygonPoint(r,o)?0:this._distanceLineStringPoint(r[0],o);case"LineString":return this._containsPolygonLineString(r,o)?0:this._distanceLineStringLineString(r[0],o);case"Polygon":return this._containsPolygonLineString(r,o[0])?0:this._distanceLineStringLineString(r[0],o[0]);default:return i}}},_distancePointPoint:function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.sqrt(i*i+s*s)},_distanceLineStringPoint:function(t,e){var i=s;if(t.length>0){var n=t[0],r=e[0]-n[0],o=e[1]-n[1];if(1===t.length)return Math.sqrt(r*r+o*o);for(var a=1;t.length>a;a++){var h=t[a],c=h[0]-n[0],l=h[1]-n[1],u=e[0]-h[0],_=e[1]-h[1],d=this._distanceSegmentPoint(c,l,r,o,u,_);if(0===d)return 0;i>d&&(i=d),n=h,r=u,o=_}}return Math.sqrt(i)},_distanceSegmentPoint:function(t,e,i,s,n,r){var o=t*i+e*s;if(0>=o)return i*i+s*s;var a=t*t+e*e;return o>=a?n*n+r*r:i*i+s*s-o*o/a},_distanceLineStringLineString:function(t,e){for(var i=s,n=0;e.length>n;n++)i=Math.min(i,this._distanceLineStringPoint(t,e[n]));return i},_buffer:function(e,s,n){var r=!1,o=e.coordinates;if(!n&&t.geo.proj&&this._isGeodetic(e.coordinates)&&(r=!0,o=t.geo.proj.fromGeodetic(e.coordinates)),"Point"===e.type){for(var a,h=[],c=180,l=0;c>=l;l++)a=360*l/c*(Math.PI/180),h.push([o[0]+Math.cos(a)*s,o[1]+Math.sin(a)*s]);return{type:"Polygon",coordinates:[r?t.geo.proj.toGeodetic(h):h]}}return i},_flatten:function(e){var i=[],s=0;switch(e.type){case"Feature":t.merge(i,this._flatten(e.geometry));break;case"FeatureCollection":for(;e.features.length>s;s++)t.merge(i,this._flatten(e.features[s].geometry));break;case"GeometryCollection":for(;e.geometries.length>s;s++)t.merge(i,this._flatten(e.geometries[s]));break;default:i[0]=e}return i},length:function(e,i){var s,n,r,o=0,a=1;switch(e.type){case"Point":return 0;case"LineString":s=e.coordinates;break;case"Polygon":s=e.coordinates[0]}if(s){for(!i&&t.geo.proj&&this._isGeodetic(s)&&(s=t.geo.proj.fromGeodetic(s));s.length>a;a++)n=s[a][0]-s[a-1][0],r=s[a][1]-s[a-1][1],o+=Math.sqrt(n*n+r*r);return o}},area:function(e,i){var s,n,r=0,o=1;switch(e.type){case"Point":case"LineString":return 0;case"Polygon":s=e.coordinates[0]}if(s){for(!i&&t.geo.proj&&this._isGeodetic(s)&&(s=t.geo.proj.fromGeodetic(s));s.length>=o;o++)n=o%s.length,r+=(s[o-1][0]-s[n][0])*(s[o-1][1]+s[n][1])/2;return Math.abs(r)}},pointAlong:function(e,i,s){var n,r,o,a,h,c,l,u,_=0,d=0,p=0,g=[],f=1,m=!1;switch(e.type){case"Point":return t.extend({},e);case"LineString":o=e.coordinates;break;case"Polygon":o=e.coordinates[0]}if(o){if(0===i)return{type:"Point",coordinates:[o[0][0],o[0][1]]};if(1===i)return f=o.length-1,{type:"Point",coordinates:[o[f][0],o[f][1]]};for(!s&&t.geo.proj&&this._isGeodetic(o)&&(m=!0,o=t.geo.proj.fromGeodetic(o));o.length>f;f++)a=o[f][0]-o[f-1][0],h=o[f][1]-o[f-1][1],r=Math.sqrt(a*a+h*h),g.push(r),_+=r;for(f=0;g.length>f&&i>p;f++)d=p,p+=g[f]/_;return n=i-d,l=o[f-1],u=o[f],c=[l[0]+n*(u[0]-l[0]),l[1]+n*(u[1]-l[1])],{type:"Point",coordinates:m?t.geo.proj.toGeodetic(c):c}}},_WKT:function(){function e(t){return"POINT "+i(t.coordinates)}function i(t){return t&&t.length?"("+t.join(" ")+")":"EMPTY"}function s(t){return"LINESTRING "+n(t.coordinates)}function n(t){if(t&&t.length){for(var e=[],i=0;t.length>i;i++)e.push(t[i].join(" "));return"("+e+")"}return"EMPTY"}function r(t){return"POLYGON "+o(t.coordinates)}function o(t){if(t&&t.length){for(var e=[],i=0;t.length>i;i++)e.push(n(t[i]));return"("+e+")"}return"EMTPY"}function a(t){return"MULTIPOINT "+n(t.coordinates)}function h(t){return"MULTILINSTRING "+o(t.coordinates)}function c(t){return"MULTIPOLYGON "+l(t.coordinates)}function l(t){if(t&&t.length){for(var e=[],i=0;t.length>i;i++)e.push(o(t[i]));return"("+e+")"}return"EMPTY"}function u(t){return"GEOMETRYCOLLECTION "+_(t.geometries)}function _(t){if(t&&t.length){for(var e=[],i=0;t.length>i;i++)e.push(d(t[i]));return"("+t+")"}return"EMPTY"}function d(t){if(!t||!t.type)return"";switch(t.type){case"Point":return e(t);case"LineString":return s(t);case"Polygon":return r(t);case"MultiPoint":return a(t);case"MultiLineString":return h(t);case"MultiPolygon":return c(t);case"GeometryCollection":return u(t);default:return""}}function p(t){var e=t.match(/\(\s*([\d\.\-]+)\s+([\d\.\-]+)\s*\)/);return e&&e.length>2?{type:"Point",coordinates:[parseFloat(e[1]),parseFloat(e[2])]}:null}function g(t){var e,i,s=t.match(/\s*\((.*)\)/),n=[],r=0;if(s&&s.length>1){for(e=s[1].match(/[\d\.\-]+\s+[\d\.\-]+/g);e.length>r;r++)i=e[r].match(/\s*([\d\.\-]+)\s+([\d\.\-]+)\s*/),n[r]=[parseFloat(i[1]),parseFloat(i[2])];return{type:"LineString",coordinates:n}}return null}function f(t){var e,i,s=t.match(/\s*\(\s*\((.*)\)\s*\)/),n=[],r=0;if(s&&s.length>1){for(e=s[1].match(/[\d\.\-]+\s+[\d\.\-]+/g);e.length>r;r++)i=e[r].match(/\s*([\d\.\-]+)\s+([\d\.\-]+)\s*/),n[r]=[parseFloat(i[1]),parseFloat(i[2])];return{type:"Polygon",coordinates:[n]}}return null}function m(e){var i;return-1===e.indexOf("((")?i=g(e):(i=v(e),i.coordinates=t.geo._allCoordinates(i)),i.type="MultiPoint",i}function v(t){for(var e=t.substr(1,t.length-2),i=e.split(")),(("),s=0,n={type:"MultiLineString",coordinates:[]};i.length>s;s++)n.coordinates.push(g(i[s]).coordinates);return n}function x(t){for(var e=t.substr(1,t.length-2),i=e.split(")),(("),s=0,n={type:"MultiPolygon",coordinates:[]};i.length>s;s++)n.coordinates.push(f(i[s]).coordinates);return n}function y(t){var e,i,s=t.substr(1,t.length-2),n=s.match(/\),[a-zA-Z]/g),r={type:"GeometryCollection",geometries:[]},o=0,a=0;if(n&&n.length>0){for(;n.length>o;o++)i=s.indexOf(n[o],a)-a+1,e=w(s.substr(a,i)),e&&r.geometries.push(e),a+=i+1;return e=w(s.substr(a)),e&&r.geometries.push(e),r}return null}function w(e){e=t.trim(e);var i=e.indexOf("("),s=e.substr(i);switch(t.trim(e.substr(0,i)).toUpperCase()){case"POINT":return p(s);case"LINESTRING":return g(s);case"POLYGON":return f(s);case"MULTIPOINT":return m(s);case"MULTILINESTRING":return v(s);case"MULTIPOLYGON":return x(s);case"GEOMETRYCOLLECTION":return y(s);default:return null}}return{stringify:d,parse:w}}(),proj:function(){var e=1.5707963267948966,i=.7853981633974483,s=.017453292519943295,n=57.29577951308232,r=6378137;return{fromGeodeticPos:function(t){return[r*t[0]*s,r*Math.log(Math.tan(i+t[1]*s/2))]},fromGeodetic:function(e){if(!t.geo._isGeodetic(e))return e;var i=t.isArray(e[0]),s=this.fromGeodeticPos;if(i||4!==e.length){var n,r,o,a=i&&t.isArray(e[0][0]),h=a&&t.isArray(e[0][0][0]),c=[];for(h||(a||(i||(e=[e]),e=[e]),e=[e]),n=0;e.length>n;n++)for(c[n]=[],r=0;e[n].length>r;r++)for(c[n][r]=[],o=0;e[n][r].length>o;o++)c[n][r][o]=s(e[n][r][o]);return h?c:a?c[0]:i?c[0][0]:c[0][0][0]}var l=s([e[0],e[1]]),u=s([e[2],e[3]]);return[l[0],l[1],u[0],u[1]]},toGeodeticPos:function(t){return[t[0]/r*n,(e-2*Math.atan(1/Math.exp(t[1]/r)))*n]},toGeodetic:function(e){if(t.geo._isGeodetic(e))return e;var i=t.isArray(e[0]),s=this.toGeodeticPos;if(i||4!==e.length){var n,r,o,a=i&&t.isArray(e[0][0]),h=a&&t.isArray(e[0][0][0]),c=[];for(h||(a||(i||(e=[e]),e=[e]),e=[e]),n=0;e.length>n;n++)for(c[n]=[],r=0;e[n].length>r;r++)for(c[n][r]=[],o=0;e[n][r].length>o;o++)c[n][r][o]=s(e[n][r][o]);return h?c:a?c[0]:i?c[0][0]:c[0][0][0]}var l=s([e[0],e[1]]),u=s([e[2],e[3]]);return[l[0],l[1],u[0],u[1]]}}}(),_serviceTypes:{}}}(jQuery,this),function(t,e){var i=function(){var t=5,e=document.createElement("div"),i=e.all||[];do e.innerHTML="<!--[if gt IE "+ ++t+"]><br><![endif]-->";
while(i[0]);return t>6?t:!t}();t.widget("geo.geographics",{_$elem:e,_options:{},_trueCanvas:!0,_trueDoubleBuffer:!0,_width:0,_height:0,_$canvas:e,_context:e,_$canvasSceneFront:e,_$canvasSceneBack:e,_timeoutEnd:null,_requireFlip:!1,_blitcanvas:e,_blitcontext:e,_$labelsContainerFront:e,_$labelsContainerBack:e,_labelsHtml:"",options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"},doubleBuffer:!0},_create:function(){this._$elem=this.element,this._options=this.options,this._$elem.css({webkitTransform:"translateZ(0)",display:"inline-block",overflow:"hidden",textAlign:"left"}),"static"===this._$elem.css("position")&&this._$elem.css("position","relative"),this._$elem.addClass("geo-graphics"),this._width=this._$elem.width(),this._height=this._$elem.height(),this._width&&this._height||(this._width=parseInt(this._$elem.css("width"),10),this._height=parseInt(this._$elem.css("height"),10));var e="position:absolute;left:0;top:0;margin:0;padding:0;",s="width:"+this._width+"px;height:"+this._height+"px;",n='width="'+this._width+'" height="'+this._height+'"';this._blitcanvas=document.createElement("canvas"),this._blitcanvas.getContext?(this._$canvas=t("<canvas "+n+' style="-webkit-transform:translateZ(0);'+e+'"></canvas>'),this._blitcanvas.width=1,this._blitcanvas.height=1,this._trueDoubleBuffer=this._blitcanvas.toDataURL().length>6,this._options.doubleBuffer&&this._trueDoubleBuffer||this._$elem.append(this._$canvas),this._context=this._$canvas[0].getContext("2d"),this._blitcanvas.width=this._width,this._blitcanvas.height=this._height,this._blitcontext=this._blitcanvas.getContext("2d"),this._$canvasSceneFront=t('<img id="scene0" style="-webkit-transform:translateZ(0);'+e+s+'" />').load(t.proxy(this._canvasSceneLoad,this)),this._$canvasSceneBack=t('<img id="scene1" style="-webkit-transform:translateZ(0);'+e+s+'" />').load(t.proxy(this._canvasSceneLoad,this))):8>=i&&(this._trueCanvas=!1,this._$elem.append("<div "+n+' style="'+e+s+'"></div>'),this._$canvas=this._$elem.children(":last"),G_vmlCanvasManager.initElement(this._$canvas[0]),this._context=this._$canvas[0].getContext("2d"),this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})),this._$labelsContainerFront=t('<div class="geo-labels-container" style="-webkit-transform:translateZ(0);'+e+s+'"></div>'),this._$labelsContainerBack=t('<div class="geo-labels-container" style="-webkit-transform:translateZ(0);'+e+s+'"></div>')},_setOption:function(e,i){"style"===e&&(i=t.extend({},this._options.style,i)),t.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){t.Widget.prototype.destroy.apply(this,arguments),this._$elem.html(""),this._$elem.removeClass("geo-graphics")},clear:function(){this._context.clearRect(0,0,this._width,this._height),this._labelsHtml="",this._end()},drawArc:function(t,e,i,s){if(s=this._getGraphicStyle(s),"hidden"!==s.visibility&&s.opacity>0&&s.widthValue>0&&s.heightValue>0){var n=Math.min(s.widthValue,s.heightValue)/2;e=e*Math.PI/180,i=i*Math.PI/180,this._context.save(),this._context.translate(t[0],t[1]),s.widthValue>s.heightValue?this._context.scale(s.widthValue/s.heightValue,1):this._context.scale(1,s.heightValue/s.widthValue),this._context.beginPath(),this._context.arc(0,0,n,e,i,!1),this._trueCanvas&&this._context.restore(),s.doFill&&(this._context.fillStyle=s.fill,this._context.globalAlpha=s.opacity*s.fillOpacity,this._context.fill()),s.doStroke&&(this._context.lineJoin="round",this._context.lineWidth=s.strokeWidthValue,this._context.strokeStyle=s.stroke,this._context.globalAlpha=s.opacity*s.strokeOpacity,this._context.stroke()),this._trueCanvas||this._context.restore()}this._end()},drawPoint:function(t,e){e=this._getGraphicStyle(e),e.widthValue===e.heightValue&&e.heightValue===e.borderRadiusValue?this.drawArc(t,0,360,e):"hidden"!==e.visibility&&e.opacity>0&&(e.borderRadiusValue=Math.min(Math.min(e.widthValue,e.heightValue)/2,e.borderRadiusValue),t[0]-=e.widthValue/2,t[1]-=e.heightValue/2,this._context.beginPath(),this._context.moveTo(t[0]+e.borderRadiusValue,t[1]),this._context.lineTo(t[0]+e.widthValue-e.borderRadiusValue,t[1]),this._context.quadraticCurveTo(t[0]+e.widthValue,t[1],t[0]+e.widthValue,t[1]+e.borderRadiusValue),this._context.lineTo(t[0]+e.widthValue,t[1]+e.heightValue-e.borderRadiusValue),this._context.quadraticCurveTo(t[0]+e.widthValue,t[1]+e.heightValue,t[0]+e.widthValue-e.borderRadiusValue,t[1]+e.heightValue),this._context.lineTo(t[0]+e.borderRadiusValue,t[1]+e.heightValue),this._context.quadraticCurveTo(t[0],t[1]+e.heightValue,t[0],t[1]+e.heightValue-e.borderRadiusValue),this._context.lineTo(t[0],t[1]+e.borderRadiusValue),this._context.quadraticCurveTo(t[0],t[1],t[0]+e.borderRadiusValue,t[1]),this._context.closePath(),e.doFill&&(this._context.fillStyle=e.fill,this._context.globalAlpha=e.opacity*e.fillOpacity,this._context.fill()),e.doStroke&&(this._context.lineJoin="round",this._context.lineWidth=e.strokeWidthValue,this._context.strokeStyle=e.stroke,this._context.globalAlpha=e.opacity*e.strokeOpacity,this._context.stroke()),this._end())},drawLineString:function(t,e){this._drawLines([t],!1,e)},drawPolygon:function(t,e){if(this._trueCanvas&&1!==t.length){if(!t||!t.length||3>t[0].length)return;e=this._getGraphicStyle(e);var i,s,n;if("hidden"!==e.visibility&&e.opacity>0){if(this._blitcontext.clearRect(0,0,this._width,this._height),e.doFill&&t.length>1)for(this._blitcontext.globalCompositeOperation="source-out",this._blitcontext.globalAlpha=1,s=1;t.length>s;s++){for(this._blitcontext.beginPath(),this._blitcontext.moveTo(t[s][0][0],t[s][0][1]),n=1;t[s].length>n;n++)this._blitcontext.lineTo(t[s][n][0],t[s][n][1]);this._blitcontext.closePath(),this._blitcontext.fill()}for(this._blitcontext.beginPath(),this._blitcontext.moveTo(t[0][0][0],t[0][0][1]),i=[t[0][0][0]-e.strokeWidthValue,t[0][0][1]-e.strokeWidthValue,t[0][0][0]+e.strokeWidthValue,t[0][0][1]+e.strokeWidthValue],s=1;t[0].length-1>s;s++)this._blitcontext.lineTo(t[0][s][0],t[0][s][1]),i[0]=Math.min(t[0][s][0]-e.strokeWidthValue,i[0]),i[1]=Math.min(t[0][s][1]-e.strokeWidthValue,i[1]),i[2]=Math.max(t[0][s][0]+e.strokeWidthValue,i[2]),i[3]=Math.max(t[0][s][1]+e.strokeWidthValue,i[3]);if(this._blitcontext.closePath(),this._blitcontext.globalCompositeOperation="source-out",e.doFill&&(this._blitcontext.fillStyle=e.fill,this._blitcontext.globalAlpha=e.opacity*e.fillOpacity,this._blitcontext.fill()),this._blitcontext.globalCompositeOperation="source-over",e.doStroke&&(this._blitcontext.lineCap=this._blitcontext.lineJoin="round",this._blitcontext.lineWidth=e.strokeWidthValue,this._blitcontext.strokeStyle=e.stroke,this._blitcontext.globalAlpha=e.opacity*e.strokeOpacity,this._blitcontext.stroke(),t.length>1))for(s=1;t.length>s;s++){for(this._blitcontext.beginPath(),this._blitcontext.moveTo(t[s][0][0],t[s][0][1]),n=1;t[s].length>n;n++)this._blitcontext.lineTo(t[s][n][0],t[s][n][1]);this._blitcontext.closePath(),this._blitcontext.stroke()}i[0]=Math.min(Math.max(i[0],0),this._width),i[1]=Math.min(Math.max(i[1],0),this._height),i[2]=Math.min(Math.max(i[2],0),this._width),i[3]=Math.min(Math.max(i[3],0),this._height),i[0]!==i[2]&&i[1]!==i[3]&&(this._context.drawImage(this._blitcanvas,i[0],i[1],i[2]-i[0],i[3]-i[1],i[0],i[1],i[2]-i[0],i[3]-i[1]),this._end())}}else this._drawLines(t,!0,e)},drawBbox:function(t,e){this._drawLines([[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]],!0,e)},drawLabel:function(t,e){this._labelsHtml+='<div class="geo-label" style="-webkit-transform:translateZ(0);position:absolute; left:'+100*(t[0]/this._width)+"%; top:"+100*(t[1]/this._height)+'%;">'+e+"</div>"},resize:function(t,e){this._width=this._$elem.width(),this._height=this._$elem.height(),this._width&&this._height||(this._width=parseInt(this._$elem.css("width"),10),this._height=parseInt(this._$elem.css("height"),10)),this._trueCanvas?(this._$canvas[0].width=this._width,this._$canvas[0].height=this._height,this._$canvasSceneFront.css({left:t,top:e}),this._$canvasSceneBack.css({width:this._width,height:this._height})):this._$canvas.css({width:this._width,height:this._height});var i=this._$labelsContainerFront.position();this._$labelsContainerFront.css({left:i.left+t,top:i.top+e,width:this._width,height:this._height}),this._$labelsContainerBack.css({width:this._width,height:this._height})},interactiveTransform:function(t,e){if(this._timeoutEnd&&(clearTimeout(this._timeoutEnd),this._timeoutEnd=null),this._trueCanvas)if(this._options.doubleBuffer&&this._trueDoubleBuffer){if(this._requireFlip){var i=this,s=i._$canvasSceneFront;i._$canvasSceneFront=i._$canvasSceneBack.css({left:0,top:0,width:i._width,height:i._height}).prop("src",i._$canvas[0].toDataURL()).prependTo(i._$elem),i._$canvasSceneBack=s.detach(),i._requireFlip=!1}this._$canvasSceneFront.css({left:Math.round(t[0]),top:Math.round(t[1]),width:this._width*e,height:this._height*e})}else this._context.clearRect(0,0,this._width,this._height);else this._context.clearRect(0,0,this._width,this._height);this._$labelsContainerFront.css({left:Math.round(t[0]),top:Math.round(t[1]),width:this._width*e,height:this._height*e})},_canvasSceneLoad:function(){var t=this;if(t._requireFlip){t._requireFlip=!1;var e=t._$canvasSceneFront;t._$canvasSceneFront=t._$canvasSceneBack.css({left:0,top:0,width:t._width,height:t._height}).prependTo(t._$elem),t._$canvasSceneBack=e.detach()}},_endCallback:function(){var t=this;if(t._timeoutEnd){t._trueCanvas&&t._options.doubleBuffer&&t._trueDoubleBuffer&&t._$canvasSceneBack.prop("src",t._$canvas[0].toDataURL()),t._$labelsContainerBack.html(t._labelsHtml).find("a").css({position:"relative",zIndex:1,display:"inline-block",webkitTransform:"translateZ(0)"});var e=t._$labelsContainerFront;t._$labelsContainerFront=t._$labelsContainerBack.css({left:0,top:0,width:t._width,height:t._height}).prependTo(t._$elem),t._$labelsContainerBack=e.detach(),t._timeoutEnd=null}},_end:function(){this._timeoutEnd&&(clearTimeout(this._timeoutEnd),this._timeoutEnd=null),this._requireFlip=!0,this._timeoutEnd=setTimeout(t.proxy(this._endCallback,this),20)},_getGraphicStyle:function(e){function i(t){return t=parseInt(t,10),+t+""===t?+t:t}return e=t.extend({},this._options.style,e),e.borderRadiusValue=i(e.borderRadius),e.fill=e.fill||e.color,e.doFill=e.fill&&e.fillOpacity>0,e.stroke=e.stroke||e.color,e.strokeWidthValue=i(e.strokeWidth),e.doStroke=e.stroke&&e.strokeOpacity>0&&e.strokeWidthValue>0,e.widthValue=i(e.width),e.heightValue=i(e.height),e},_drawLines:function(t,e,i){if(t&&t.length&&!(2>t[0].length)){var s,n;if(i=this._getGraphicStyle(i),"hidden"!==i.visibility&&i.opacity>0){for(this._context.beginPath(),s=0;t.length>s;s++)for(this._context.moveTo(t[s][0][0],t[s][0][1]),n=1;t[s].length>n;n++)this._context.lineTo(t[s][n][0],t[s][n][1]);e&&this._context.closePath(),e&&i.doFill&&(this._context.fillStyle=i.fill,this._context.globalAlpha=i.opacity*i.fillOpacity,this._context.fill()),i.doStroke&&(this._context.lineCap=this._context.lineJoin="round",this._context.lineWidth=i.strokeWidthValue,this._context.strokeStyle=i.stroke,this._context.globalAlpha=i.opacity*i.strokeOpacity,this._context.stroke()),this._end()}}}})}(jQuery),function(t,e){var i=0,s=function(){var t=5,e=document.createElement("div"),i=e.all||[];do e.innerHTML="<!--[if gt IE "+ ++t+"]><br><![endif]-->";while(i[0]);return t>6?t:!t}(),n={bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{"static":"default",pan:"url(data:image/vnd.microsoft.icon;base64,AAACAAEAICACAAgACAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAA//AAAd/wAAGf+AAAH9gAADbYAAA2yAAAZsAAAGbAAAAGAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//4AB//8AAf//AAD//5AA///gAP//4AD//8AF///AB///5A////5///8=), move",click:"crosshair",zoom:"crosshair",dragBox:"crosshair",dragCircle:"crosshair",drawPoint:"crosshair",drawLineString:"crosshair",drawPolygon:"crosshair",measureLength:"crosshair",measureArea:"crosshair"},measureLabels:{length:"{{:length.toFixed( 2 )}} m",area:"{{:area.toFixed( 2 )}} sq m"},drawStyle:{},shapeStyle:{},mode:"pan",pannable:!0,scroll:"default",shift:"default",services:[{"class":"osm",type:"tiled",src:function(t){return"http://otile"+(t.index%4+1)+".mqcdn.com/tiles/1.0.0/osm/"+t.zoom+"/"+t.tile.column+"/"+t.tile.row+".png"},attr:"Tiles Courtesy of <a href='http://www.mapquest.com/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png'>"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-20037508.342787,20037508.342787]},axisLayout:"map",zoom:0,zoomMin:0,zoomMax:Number.POSITIVE_INFINITY,zoomFactor:2,pixelSize:0};t.widget("geo.geomap",{_$elem:e,_map:e,_created:!1,_createdGraphics:!1,_widgetId:0,_tmplLengthId:"",_tmplAreaId:"",_contentBounds:{},_$resizeContainer:e,_$eventTarget:e,_$contentFrame:e,_$existingChildren:e,_$attrList:e,_$servicesContainer:e,_$shapesContainers:e,_$panContainer:e,_$shapesContainer:e,_$drawContainer:e,_$measureContainer:e,_$measureLabel:e,_dpi:96,_currentServices:[],_center:e,_pixelSize:e,_centerMax:e,_pixelSizeMax:e,_userGeodetic:!0,_centerInteractive:e,_pixelSizeInteractive:e,_timeoutInteractive:null,_triggerInteractive:!1,_timeoutRefreshShapes:null,_loadCount:0,_wheelLevel:0,_fullZoomFactor:2,_partialZoomFactor:1.18920711500273,_mouseDown:e,_inOp:e,_toolPan:e,_shiftDown:e,_anchor:e,_current:e,_downDate:e,_moveDate:e,_clickDate:e,_lastMove:e,_lastDrag:e,_windowHandler:null,_resizeTimeout:null,_panning:e,_velocity:e,_friction:e,_supportTouch:e,_softDblClick:e,_isTap:e,_isDbltap:e,_isMultiTouch:e,_multiTouchAnchor:[],_multiTouchAnchorBbox:e,_multiTouchCurrentBbox:e,_drawTimeout:null,_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:t.extend({},n),_createWidget:function(s,n){if(this._$elem=t(n),this._$elem.is(".geo-service"))return this._graphicShapes=[],t.Widget.prototype._createWidget.apply(this,arguments),e;this._widgetId=i++,this._tmplLengthId="geoMeasureLength"+this._widgetId,this._tmplAreaId="geoMeasureArea"+this._widgetId,this._$elem.addClass("geo-map").css({webkitTransform:"translateZ(0)"}),this._initOptions=s||{},this._forcePosition(this._$elem),this._$elem.css("text-align","left");var r=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left"),10),y:parseInt(this._$elem.css("padding-top"),10),width:r.width,height:r.height},this._createChildren(),this._center=[0,0],this._centerMax=[0,0],this._centerInteractive=[0,0],this.options.pixelSize=this._pixelSize=this._pixelSizeMax=156543.03392799935,this._mouseDown=this._inOp=this._toolPan=this._shiftDown=this._panning=this._isTap=this._isDbltap=!1,this._anchor=[0,0],this._current=[0,0],this._lastMove=[0,0],this._lastDrag=[0,0],this._velocity=[0,0],this._friction=[.8,.8],this._downDate=this._moveDate=this._clickDate=0,this._drawPixels=[],this._drawCoords=[],this._graphicShapes=[],t.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){if(this._options=this.options,this._$elem.is(".geo-service"))return this._map=this._$elem.data("geoMap"),this._$elem.data("geoService",this),e;this._map=this,this._supportTouch="ontouchend"in document,this._softDblClick=this._supportTouch||7===s;var i=this,n=this._supportTouch?"touchstart mousedown":"mousedown",r=this._supportTouch?"touchend touchcancel mouseup":"mouseup",o=this._supportTouch?"touchmove mousemove":"mousemove";t(document).keydown(t.proxy(this._document_keydown,this)),this._$eventTarget.dblclick(t.proxy(this._eventTarget_dblclick,this)),this._$eventTarget.bind(n,t.proxy(this._eventTarget_touchstart,this));var a=this._$eventTarget[0].setCapture?this._$eventTarget:t(document);a.bind(o,t.proxy(this._dragTarget_touchmove,this)),a.bind(r,t.proxy(this._dragTarget_touchstop,this)),this._$eventTarget.mousewheel(t.proxy(this._eventTarget_mousewheel,this)),this._windowHandler=function(){i._resizeTimeout&&clearTimeout(i._resizeTimeout),i._resizeTimeout=setTimeout(function(){i._created&&i._$elem.geomap("resize",!0)},500)},t(window).resize(this._windowHandler),this._$drawContainer.geographics({style:this._initOptions.drawStyle||{},doubleBuffer:!1}),this._options.drawStyle=this._$drawContainer.geographics("option","style"),this._$shapesContainer.geographics({style:this._initOptions.shapeStyle||{}}),this._createdGraphics=!0,this._options.shapeStyle=this._$shapesContainer.geographics("option","style"),this._initOptions&&(this._initOptions.tilingScheme!==e&&this._setOption("tilingScheme",this._initOptions.tilingScheme||null,!1),this._initOptions.services&&(this._options.services=t.merge([],this._initOptions.services)),this._initOptions.bboxMax&&(this._setOption("bboxMax",this._initOptions.bboxMax,!1),this._setOption("bbox",this._initOptions.bboxMax,!1)),this._initOptions.zoomMin!==e&&this._setOption("zoomMin",this._initOptions.zoomMin,!1),this._initOptions.zoomMax!==e&&this._setOption("zoomMax",this._initOptions.zoomMax,!1),this._initOptions.zoomFactor!==e&&(this._setOption("zoomFactor",this._initOptions.zoomFactor,!1),this._fullZoomFactor=this._initOptions.zoomFactor,this._partialZoomFactor=Math.pow(4,1/this._fullZoomFactor)),this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,!1),this._initOptions.center&&this._setOption("center",this._initOptions.center,!1),this._initOptions.zoom!==e&&this._setOption("zoom",this._initOptions.zoom,!1)),t.templates(this._tmplLengthId,this._options.measureLabels.length),t.templates(this._tmplAreaId,this._options.measureLabels.area),this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._createServices(),this._refresh(),this._created=!0},_setOption:function(i,s,n){if("pixelSize"!==i){n=n===e||n,this._$elem.is(".geo-map")&&this._panFinalize();var r,o,a,h;switch(i){case"bbox":this._created&&this._clearInteractiveTimeout(),this._userGeodetic="map"===this._options.axisLayout&&t.geo.proj&&t.geo._isGeodetic(s),this._userGeodetic&&(s=t.geo.proj.fromGeodetic(s)),r=[s[0]+(s[2]-s[0])/2,s[1]+(s[3]-s[1])/2],o=Math.max(t.geo.width(s,!0)/this._contentBounds.width,t.geo.height(s,!0)/this._contentBounds.height),h=this._getZoom(r,o),this._options.tilingScheme?o=this._getPixelSize(Math.min(Math.max(h,this._options.zoomMin),this._options.zoomMax)):this._options.zoomMin>h?o=this._getPixelSize(this._options.zoomMin):h>this._options.zoomMax&&(o=this._getPixelSize(this._options.zoomMax)),this._created?(this._setInteractiveCenterAndSize(r,o),this._setInteractiveTimeout(!1)):this._setCenterAndSize(r,o,!1,n),s=this._getBbox(r,o);break;case"bboxMax":this._userGeodetic="map"===this._options.axisLayout&&t.geo.proj&&t.geo._isGeodetic(s);break;case"center":this._created&&this._clearInteractiveTimeout(),this._userGeodetic="map"===this._options.axisLayout&&t.geo.proj&&t.geo._isGeodetic(s),this._userGeodetic&&(s=t.geo.proj.fromGeodetic(s)),this._created?(this._setInteractiveCenterAndSize(s,this._pixelSizeInteractive),this._interactiveTransform(),this._setInteractiveTimeout(!1)):this._setCenterAndSize(s,this._pixelSize,!1,n);break;case"measureLabels":s=t.extend(this._options.measureLabels,s),t.templates(this._tmplLengthId,this._options.measureLabels.length),t.templates(this._tmplAreaId,this._options.measureLabels.area);break;case"drawStyle":this._$drawContainer&&(this._$drawContainer.geographics("option","style",s),s=this._$drawContainer.geographics("option","style"));break;case"shapeStyle":this._$elem.is(".geo-service")&&!this._createdGraphics&&this._createServiceGraphics(),this._createdGraphics&&(this._$shapesContainer.geographics("option","style",s),s=this._$shapesContainer.geographics("option","style"));break;case"mode":this._resetDrawing(),this._$eventTarget.css("cursor",this._options.cursors[s]);break;case"zoom":this._created?this._setZoom(s,!1,n):(s=Math.max(s,0),this._setCenterAndSize(this._center,this._getPixelSize(s),!1,n))}switch(t.Widget.prototype._setOption.apply(this,arguments),i){case"bbox":case"center":this._userGeodetic&&(this._options.bbox=t.geo.proj.toGeodetic(this._options.bbox),this._options.center=t.geo.proj.toGeodetic(this._center));break;case"tilingScheme":null!==s&&(this._pixelSizeMax=this._getPixelSize(0),this._centerMax=[s.origin[0]+this._pixelSizeMax*s.tileWidth/2,s.origin[1]+this._pixelSizeMax*s.tileHeight/2]);break;case"bboxMax":a=this._userGeodetic?t.geo.proj.fromGeodetic(s):s,this._centerMax=t.geo.center(a),this._pixelSizeMax=Math.max(t.geo.width(a,!0)/this._contentBounds.width,t.geo.height(a,!0)/this._contentBounds.height);break;case"services":this._createServices(),n&&(this._refresh(),this._refreshAllShapes());break;case"shapeStyle":n&&this._createdGraphics&&(this._$shapesContainer.geographics("clear"),this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes))}}},destroy:function(){if(this._$elem.is(".geo-service"))this._createdGraphics&&(this._$shapesContainer.geographics("destroy"),this._$shapesContainer=e,this._createdGraphics=!1);else{clearTimeout(this._timeoutInteractive),this._timeoutInteractive=null,this._created=!1,t(window).unbind("resize",this._windowHandler);for(var i=0;this._currentServices.length>i;i++)this._currentServices[i].serviceContainer.geomap("destroy"),t.geo._serviceTypes[this._currentServices[i].type].destroy(this,this._$servicesContainer,this._currentServices[i]);this._$shapesContainer.geographics("destroy"),this._$shapesContainer=e,this._createdGraphics=!1,this._$drawContainer.geographics("destroy"),this._$drawContainer=e,this._$existingChildren.detach(),this._$elem.html(""),this._$elem.append(this._$existingChildren),this._$elem.removeClass("geo-map")}t.Widget.prototype.destroy.apply(this,arguments)},toMap:function(e){return e=this._toMap(e),this._userGeodetic?t.geo.proj.toGeodetic(e):e},toPixel:function(e,i,s){return this._toPixel(t.geo.proj?t.geo.proj.fromGeodetic(e):e,i,s)},opacity:function(e,i){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("opacity",e,this._$elem);else if(e>=0||1>=e)for(var s=0;this._currentServices.length>s;s++){var n=this._currentServices[s];i&&n.serviceContainer[0]!==i[0]||(n.style.opacity=e,n.serviceObject.style=t.extend({},n.serviceObject.style,n.style),t.geo._serviceTypes[n.type].opacity(this,n))}},toggle:function(i,s){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("toggle",i,this._$elem);else for(var n=0;this._currentServices.length>n;n++){var r=this._currentServices[n];s&&r.serviceContainer[0]!==s[0]||(i===e&&(i="visible"!==r.style.visibility),r.style.visibility=i?"visible":"hidden",r.serviceObject.style=t.extend({},r.serviceObject.style,r.style),r.serviceContainer.toggle(i),i&&t.geo._serviceTypes[r.type].refresh(this,r))}},zoom:function(t){null!==t&&this._setZoom(this._options.zoom+t,!1,!0)},refresh:function(t,e){this._$elem.is(".geo-service")?this._$elem.closest(".geo-map").geomap("refresh",t,this._$elem):(this._refresh(t,e),this._refreshAllShapes())},resize:function(e){var i,s=this._findMapSize(),n=s.width/2-this._contentBounds.width/2,r=s.height/2-this._contentBounds.height/2;for(this._contentBounds={x:parseInt(this._$elem.css("padding-left"),10),y:parseInt(this._$elem.css("padding-top"),10),width:s.width,height:s.height},this._$resizeContainer.css({width:s.width,height:s.height}),i=0;this._currentServices.length>i;i++)t.geo._serviceTypes[this._currentServices[i].type].resize(this,this._currentServices[i],n,r);for(this._$elem.find(".geo-graphics").css({width:s.width,height:s.height}).geographics("resize",n,r),i=0;this._drawPixels.length>i;i++)this._drawPixels[i][0]+=n,this._drawPixels[i][1]+=r;this._setCenterAndSize(this._center,this._pixelSize,e,!0)},append:function(i){if(i&&(t.isPlainObject(i)||t.isArray(i)&&i.length>0)){this._createdGraphics||this._createServiceGraphics();var s,n,r,o,a,h;for(s=t.isArray(i)?i:"FeatureCollection"===i.type?i.features:[i],r=1;arguments.length>r;r++)n=arguments[r],"object"==typeof n?o=n:"number"==typeof n||"string"==typeof n?a=n:"boolean"==typeof n&&(h=n);for(r=0;s.length>r;r++){if(!t.data(s[r],"geoBbox")){var c=t.geo.bbox(s[r]);t.geo.proj&&t.geo._isGeodetic(c)&&(c=t.geo.proj.fromGeodetic(c)),t.data(s[r],"geoBbox",c)}this._graphicShapes.push({shape:s[r],style:o,label:a})}(h===e||h)&&(this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes())}},empty:function(t){this._graphicShapes=[],(t===e||t)&&(this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes())},find:function(e,i){for(var s,n,r,o=t.isPlainObject(e),a=this._map._pixelSize*i,h=[],c=0;this._graphicShapes.length>c;c++)if(s=this._graphicShapes[c],o)if("Point"===s.shape.type)a>=t.geo.distance(s.shape,e)&&h.push(s.shape);else{var l=t.data(s.shape,"geoBbox"),u={type:"Polygon",coordinates:[[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]],[l[0],l[1]]]]},_={type:"Point",coordinates:t.geo.proj&&t.geo._isGeodetic(e.coordinates)?t.geo.proj.fromGeodetic(e.coordinates):e.coordinates};if(a>=t.geo.distance(u,_,!0))for(n=t.geo._flatten(s.shape),r=0;n.length>r;r++)if(a>=t.geo.distance(n[r],e)){h.push(s.shape);break}}else h.push(s.shape);return this._$elem.is(".geo-map")&&this._$elem.find(".geo-service").each(function(){h=t.merge(h,t(this).geomap("find",e,i))}),h},remove:function(i,s){if(i&&(t.isPlainObject(i)||t.isArray(i)&&i.length>0)){for(var n,r=t.isArray(i)?i:[i],o=0;this._graphicShapes.length>o;o++)t.inArray(this._graphicShapes[o].shape,r)>=0&&(n=this._graphicShapes.slice(o+1),this._graphicShapes.length=o,this._graphicShapes.push.apply(this._graphicShapes,n),o--);(s===e||s)&&(this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes())}},_getBbox:function(t,e){t=t||this._center,e=e||this._pixelSize;var i=this._contentBounds.width/2*e,s=this._contentBounds.height/2*e;return[t[0]-i,t[1]-s,t[0]+i,t[1]+s]},_setBbox:function(e){var i=[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2],s=Math.max(t.geo.width(e,!0)/this._contentBounds.width,t.geo.height(e,!0)/this._contentBounds.height),n=this._getZoom(i,s);this._options.tilingScheme?s=this._getPixelSize(Math.min(Math.max(n,this._options.zoomMin),this._options.zoomMax)):this._options.zoomMin>n?s=this._getPixelSize(this._options.zoomMin):n>this._options.zoomMax&&(s=this._getPixelSize(this._options.zoomMax)),this._setInteractiveCenterAndSize(i,s),this._interactiveTransform()},_getBboxMax:function(){var t=this._contentBounds.width/2*this._pixelSizeMax,e=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-t,this._centerMax[1]-e,this._centerMax[0]+t,this._centerMax[1]+e]},_getCenter:function(){return this._center},_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(e,i){e=e||this._center,i=i||this._pixelSize;var s=this._options.tilingScheme;if(s){if(s.pixelSizes){for(var n=Math.floor(1e3*i),r=s.pixelSizes.length,o=r-1;o>=0;o--)if(Math.floor(1e3*s.pixelSizes[o])>=n)return o;return 0}return Math.round(Math.log(s.basePixelSize/i)/Math.log(2))}var a=this._contentBounds.width/this._contentBounds.height,h=t.geo.reaspect(this._getBbox(e,i),a,!0),c=t.geo.reaspect(this._getBboxMax(),a,!0);return Math.round(Math.log(t.geo.width(c,!0)/t.geo.width(h,!0))/Math.log(this._fullZoomFactor))},_setZoom:function(t,e){this._clearInteractiveTimeout(),t=Math.min(Math.max(t,this._options.zoomMin),this._options.zoomMax),this._setInteractiveCenterAndSize(this._centerInteractive,this._getPixelSize(t)),this._interactiveTransform(),this._setInteractiveTimeout(e)},_createChildren:function(){this._$existingChildren=this._$elem.children(),this._forcePosition(this._$existingChildren),this._$existingChildren.detach().css({mozUserSelect:"none"});var e="width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0;",i="position:absolute; left:0; top:0;";this._$elem.prepend('<div class="geo-event-target geo-content-frame" style="position:absolute; left:'+this._contentBounds.x+"px; top:"+this._contentBounds.y+"px;"+e+'overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;" unselectable="on"></div>'),this._$eventTarget=this._$contentFrame=this._$elem.children(":first"),this._$contentFrame.append('<div class="geo-services-container" style="'+i+e+'"></div>'),this._$servicesContainer=this._$contentFrame.children(":last"),this._$contentFrame.append('<ul style="position: absolute; bottom: 8px; left: 8px; list-style-type: none; max-width: 50%; padding: 0; margin: 0;"></ul>'),this._$attrList=this._$contentFrame.children(":last"),this._$contentFrame.append('<div class="geo-draw-container" style="'+i+e+'"></div>'),this._$drawContainer=this._$contentFrame.children(":last"),this._$contentFrame.append('<div class="geo-measure-container" style="'+i+e+'"><span class="geo-measure-label" style="'+i+'; display: none;"></span></div>'),this._$measureContainer=this._$contentFrame.children(":last"),this._$measureLabel=this._$measureContainer.children(),this._$contentFrame.append('<div class="geo-shapes-container" style="'+i+e+'"></div>'),this._$shapesContainer=this._$contentFrame.children(":last"),this._$panContainer=t([this._$shapesContainer[0],this._$drawContainer[0],this._$measureContainer[0]]),this._$resizeContainer=t([this._$contentFrame[0],this._$servicesContainer[0],this._$eventTarget[0],this._$measureContainer[0]]),this._$contentFrame.append(this._$existingChildren),t("#geo-measure-style").length||t("head").prepend('<style type="text/css" id="geo-measure-style">.geo-measure-label { margin: 4px 0 0 6px; font-family: sans-serif;'+(s?"letter-spacing: 2px; color: #444; filter:progid:DXImageTransform.Microsoft.DropShadow(Color=white, OffX=1, OffY=2, Positive=true);":"color: #000; text-shadow: #fff 1px 2px; font-weight: bold;")+" }</style>")},_createServices:function(){var e,i;for(i=0;this._currentServices.length>i;i++)this._currentServices[i].serviceContainer.geomap("destroy"),t.geo._serviceTypes[this._currentServices[i].type].destroy(this,this._$servicesContainer,this._currentServices[i]);for(this._currentServices=[],this._$servicesContainer.html(""),this._$attrList.html(""),i=0;this._options.services.length>i;i++){e=this._currentServices[i]=t.extend({},this._options.services[i]),e.serviceObject=this._options.services[i],e.style=t.extend({visibility:"visible",opacity:1},e.style);var s,n=e.id?' id="'+e.id+'"':"",r='class="geo-service '+(e["class"]?e["class"]:"")+'"',o="<div "+n+r+' style="-webkit-transform:translateZ(0);position:absolute; left:0; top:0; width:32px; height:32px; margin:0; padding:0; display:'+("visible"===e.style.visibility?"block":"none")+';"></div>';this._$servicesContainer.append(o),s=this._$servicesContainer.children(":last"),e.serviceContainer=s,t.geo._serviceTypes[e.type].create(this,s,e,i),s.data("geoMap",this).geomap(),e.attr&&this._$attrList.append("<li>"+e.attr+"</li>")}this._$shapesContainers=this._$shapesContainer,this._$attrList.find("a").css({position:"relative",zIndex:1,display:"inline-block",webkitTransform:"translateZ(0)"})},_createServiceGraphics:function(){var t=this._$elem.closest(".geo-content-frame");this._$elem.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0; width:'+t.css("width")+"; height:"+t.css("height")+'; margin:0; padding:0;"></div>'),this._$shapesContainer=this._$elem.children(":last"),this._map._$shapesContainers=this._map._$shapesContainers.add(this._$shapesContainer),this._$shapesContainer.geographics(),this._createdGraphics=!0,this._options.shapeStyle=this._$shapesContainer.geographics("option","style")},_refreshDrawing:function(){if(this._$drawContainer.geographics("clear"),this._drawPixels.length>0){var e,i,s,n,r,o=this._options.mode,a=this._drawPixels,h=this._drawCoords;
switch(o){case"measureLength":o="drawLineString",i={type:"LineString",coordinates:h},e=t.render[this._tmplLengthId]({length:t.geo.length(i,!0)}),s=t.merge([],a[a.length-1]);break;case"measureArea":o="drawPolygon",i={type:"Polygon",coordinates:[t.merge([],h)]},i.coordinates[0].push(h[0]),e=t.render[this._tmplAreaId]({area:t.geo.area(i,!0)}),s=this._toPixel(t.geo.centroid(i).coordinates),a=[a];break;case"drawPolygon":a=[a]}this._$drawContainer.geographics(o,a),e&&(this._$measureLabel.html(e),n=this._contentBounds.width-(this._$measureLabel.outerWidth(!0)+s[0]),r=this._contentBounds.height-(this._$measureLabel.outerHeight(!0)+s[1]),0>n&&(s[0]+=n),0>r&&(s[1]+=r),this._$measureLabel.css({left:Math.max(s[0],0),top:Math.max(s[1],0)}).show())}},_resetDrawing:function(){this._drawPixels=[],this._drawCoords=[],this._$drawContainer.geographics("clear"),this._$measureLabel.hide()},_refreshAllShapes:function(){this._timeoutRefreshShapes=null;for(var t,e,i=0;this._currentServices.length>i;i++)t=this._currentServices[i],e=t.serviceContainer.data("geoService"),e._createdGraphics&&(e._$shapesContainer.geographics("clear"),e._graphicShapes.length>0&&e._refreshShapes(e._$shapesContainer,e._graphicShapes,e._graphicShapes,e._graphicShapes));this._createdGraphics&&(this._$shapesContainer.geographics("clear"),this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes))},_refreshShapes:function(i,s,n,r,o,a){var h,c,l,u,_,d,p,g,f=this._map._getBbox(o,a);for(h=0;s.length>h;h++)if(l=s[h].shape||s[h],l=l.geometry||l,u=t.data(l,"geoBbox"),!u||!t.geo._bboxDisjoint(f,u)){switch(_=t.isArray(n)?n[h].style:n,d=t.isArray(r)?r[h].label:r,p=d!==e,g=e,l.type){case"Point":g=this._map.toPixel(l.coordinates,o,a),this._$shapesContainer.geographics("drawPoint",g,_);break;case"LineString":this._$shapesContainer.geographics("drawLineString",this._map.toPixel(l.coordinates,o,a),_),p&&(g=this._map.toPixel(t.geo.pointAlong(l,.5).coordinates,o,a));break;case"Polygon":this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(l.coordinates,o,a),_),p&&(g=this._map.toPixel(t.geo.centroid(l).coordinates,o,a));break;case"MultiPoint":for(c=0;l.coordinates.length>c;c++)this._$shapesContainer.geographics("drawPoint",this._map.toPixel(l.coordinates[c],o,a),_);p&&(g=this._map.toPixel(t.geo.centroid(l).coordinates,o,a));break;case"MultiLineString":for(c=0;l.coordinates.length>c;c++)this._$shapesContainer.geographics("drawLineString",this._map.toPixel(l.coordinates[c],o,a),_);p&&(g=this._map.toPixel(t.geo.centroid(l).coordinates,o,a));break;case"MultiPolygon":for(c=0;l.coordinates.length>c;c++)this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(l.coordinates[c],o,a),_);p&&(g=this._map.toPixel(t.geo.centroid(l).coordinates,o,a));break;case"GeometryCollection":this._refreshShapes(i,l.geometries,_,d,o,a)}p&&g&&this._$shapesContainer.geographics("drawLabel",g,d)}},_findMapSize:function(){for(var t={width:0,height:0},e=this._$elem;e.size()&&!(t.width>0&&t.height>0);)t={width:e.width(),height:e.height()},(0>=t.width||0>=t.height)&&(t={width:parseInt(e.css("width"),10),height:parseInt(e.css("height"),10)}),e=e.parent();return t},_forcePosition:function(t){var e=t.css("position");"relative"!==e&&"absolute"!==e&&"fixed"!==e&&t.css("position","relative")},_getPixelSize:function(e){var i=this._options.tilingScheme;if(null!==i){if(0===e)return i.pixelSizes?i.pixelSizes[0]:i.basePixelSize;e=Math.round(e),e=Math.max(e,0);var s=i.pixelSizes?i.pixelSizes.length:i.levels;return e=Math.min(e,s-1),i.pixelSizes?i.pixelSizes[e]:i.basePixelSize/Math.pow(2,e)}var n=t.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._fullZoomFactor,e),!0);return Math.max(t.geo.width(n,!0)/this._contentBounds.width,t.geo.height(n,!0)/this._contentBounds.height)},_getZoomCenterAndSize:function(t,e,i){var s=i?this._fullZoomFactor:this._partialZoomFactor,n=Math.pow(s,-e),r=this._pixelSizeInteractive*n,o=this._getZoom(this._centerInteractive,r);i&&this._options.tilingScheme?r=this._getPixelSize(Math.min(Math.max(o,this._options.zoomMin),this._options.zoomMax)):0>e&&this._options.zoomMin>o?r=this._pixelSizeInteractive:e>0&&o>this._options.zoomMax&&(r=this._pixelSizeInteractive);var a=r/this._pixelSizeInteractive,h=this._toMap(t,this._centerInteractive,this._pixelSizeInteractive),c=[(this._centerInteractive[0]-h[0])*a,(this._centerInteractive[1]-h[1])*a],l=[h[0]+c[0],h[1]+c[1]];return{pixelSize:r,center:l}},_panFinalize:function(){this._panning&&(this._velocity=[0,0],this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._inOp=!1,this._anchor=this._current,this._mouseDown=this._toolPan=this._panning=!1)},_panMove:function(){if(this._options.pannable){var t=this._current[0]-this._lastDrag[0],e=this._current[1]-this._lastDrag[1];(this._toolPan||t>3||-3>t||e>3||-3>e)&&(this._toolPan||(this._toolPan=!0,this._$eventTarget.css("cursor",this._options.cursors.pan)),this._mouseDown&&(this._velocity=[t,e]),(0!==t||0!==e)&&(this._panning=!0,this._lastDrag=this._current,this._centerInteractive[0]-=t*this._pixelSizeInteractive,this._centerInteractive[1]+=("image"===this._options.axisLayout?-1:1)*e*this._pixelSizeInteractive,this._setInteractiveCenterAndSize(this._centerInteractive,this._pixelSizeInteractive),this._interactiveTransform()))}},_clearInteractiveTimeout:function(){return this._timeoutRefreshShapes&&(clearTimeout(this._timeoutRefreshShapes),this._timeoutRefreshShapes=null),this._timeoutInteractive?(clearTimeout(this._timeoutInteractive),this._timeoutInteractive=null,!0):(this._centerInteractive[0]=this._center[0],this._centerInteractive[1]=this._center[1],this._pixelSizeInteractive=this._pixelSize,!1)},_interactiveTransform:function(){var e,i=this._pixelSize,s=i/this._pixelSizeInteractive;if(i>0){s=Math.round(1e3*s)/1e3;var n=this._toMap([0,0]),r=this._toPixel(n,this._centerInteractive,this._pixelSizeInteractive);this._$shapesContainers.geographics("interactiveTransform",r,s)}for(var o=0;this._currentServices.length>o;o++)e=this._currentServices[o],t.geo._serviceTypes[e.type].interactiveTransform(this,e,this._centerInteractive,this._pixelSizeInteractive);this._drawCoords.length>0&&(this._drawPixels=this._toPixel(this._drawCoords,this._centerInteractive,this._pixelSizeInteractive),this._refreshDrawing())},_interactiveTimeout:function(){this._isMultiTouch?this._timeoutInteractive=setTimeout(t.proxy(this._interactiveTimeout,this),128):this._created&&this._timeoutInteractive&&(this._setCenterAndSize(this._centerInteractive,this._pixelSizeInteractive,this._triggerInteractive,!0),this._timeoutInteractive=null,this._triggerInteractive=!1,this._timeoutRefreshShapes=setTimeout(t.proxy(this._refreshAllShapes,this),128))},_setInteractiveTimeout:function(e){this._timeoutInteractive=setTimeout(t.proxy(this._interactiveTimeout,this),128),this._triggerInteractive|=e},_refresh:function(e,i){for(var s,n=0;this._currentServices.length>n;n++)s=this._currentServices[n],i&&s.serviceContainer[0]!==i[0]||t.geo._serviceTypes[s.type].refresh(this,s,e)},_setInteractiveCenterAndSize:function(e,i){this._centerInteractive[0]=e[0],this._centerInteractive[1]=e[1],this._pixelSizeInteractive=i,this._userGeodetic?(this._options.bbox=t.geo.proj.toGeodetic(this._getBbox(e,i)),this._options.center=t.geo.proj.toGeodetic(e)):(this._options.bbox=this._getBbox(e,i),this._options.center[0]=e[0],this._options.center[1]=e[1]),this._options.pixelSize=i,this._options.zoom=this._getZoom(e,i)},_setCenterAndSize:function(e,i,s,n){if(t.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]){var r=this._getZoom(e,i);this._options.tilingScheme?this._pixelSizeInteractive=i=this._getPixelSize(Math.min(Math.max(r,this._options.zoomMin),this._options.zoomMax)):this._options.zoomMin>r?this._pixelSizeInteractive=i=this._getPixelSize(this._options.zoomMin):r>this._options.zoomMax&&(this._pixelSizeInteractive=i=this._getPixelSize(this._options.zoomMax)),this._center[0]=e[0],this._center[1]=e[1],this._options.pixelSize=this._pixelSize=i,this._userGeodetic?(this._options.bbox=t.geo.proj.toGeodetic(this._getBbox()),this._options.center=t.geo.proj.toGeodetic(this._center)):(this._options.bbox=this._getBbox(),this._options.center=t.merge([],e)),this._options.zoom=r,s&&this._trigger("bboxchange",window.event,{bbox:t.merge([],this._options.bbox)}),n&&(this._refresh(),this._refreshAllShapes(),this._refreshDrawing())}},_requestQueued:function(){0===this._loadCount&&this._trigger("loadstart",window.event),this._loadCount++},_requestComplete:function(){this._loadCount--,0>=this._loadCount&&(this._loadCount=0,this._trigger("loadend",window.event))},_toMap:function(e,i,s){i=i||this._center,s=s||this._pixelSize;var n,r,o,a,h=t.isArray(e[0]),c=h&&t.isArray(e[0][0]),l=c&&t.isArray(e[0][0][0]),u=this._contentBounds.width,_=this._contentBounds.height,d=u/2*s,p=_/2*s,g=[i[0]-d,i[1]-p,i[0]+d,i[1]+p],f=t.geo.width(g,!0)/u,m=t.geo.height(g,!0)/_,v="image"===this._options.axisLayout,x=[];for(l||(c||(h||(e=[e]),e=[e]),e=[e]),r=0;e.length>r;r++)for(x[r]=[],o=0;e[r].length>o;o++)for(x[r][o]=[],a=0;e[r][o].length>a;a++)n=e[r][o][a][1]*m,x[r][o][a]=[g[0]+e[r][o][a][0]*f,v?g[1]+n:g[3]-n];return l?x:c?x[0]:h?x[0][0]:x[0][0][0]},_toPixel:function(e,i,s){i=i||this._center,s=s||this._pixelSize;var n,r,o,a=t.isArray(e[0]),h=a&&t.isArray(e[0][0]),c=h&&t.isArray(e[0][0][0]),l=this._contentBounds.width,u=this._contentBounds.height,_=l/2*s,d=u/2*s,p=[i[0]-_,i[1]-d,i[0]+_,i[1]+d],g=t.geo.width(p,!0),f=t.geo.height(p,!0),m="image"===this._options.axisLayout,v=l/g,x=u/f,y=[];for(c||(h||(a||(e=[e]),e=[e]),e=[e]),n=0;e.length>n;n++)for(y[n]=[],r=0;e[n].length>r;r++)for(y[n][r]=[],o=0;e[n][r].length>o;o++)y[n][r][o]=[Math.round((e[n][r][o][0]-p[0])*v),Math.round((m?e[n][r][o][1]-p[1]:p[3]-e[n][r][o][1])*x)];return c?y:h?y[0]:a?y[0][0]:y[0][0][0]},_document_keydown:function(e){var i=this._drawCoords.length;i>0&&27===e.which&&(2>=i?(this._resetDrawing(),this._inOp=!1):(this._drawCoords[i-2]=t.merge([],this._drawCoords[i-1]),this._drawPixels[i-2]=t.merge([],this._drawPixels[i-1]),this._drawCoords.length--,this._drawPixels.length--,this._refreshDrawing()))},_eventTarget_dblclick_zoom:function(t){var e=this._clearInteractiveTimeout();if(this._trigger("dblclick",t,{type:"Point",coordinates:this._toMap(this._current,this._centerInteractive,this._pixelSizeInteractive)}),!t.isDefaultPrevented()){var i=this._getZoomCenterAndSize(this._current,1,!0);this._setInteractiveCenterAndSize(i.center,i.pixelSize),this._interactiveTransform(),e=!0}e&&this._setInteractiveTimeout(!0)},_eventTarget_dblclick:function(e){if("static"!==this._options.mode){switch(this._drawTimeout&&(window.clearTimeout(this._drawTimeout),this._drawTimeout=null),this._options.mode){case"drawLineString":case"measureLength":this._drawCoords.length>1&&(this._drawCoords[0][0]!==this._drawCoords[1][0]||this._drawCoords[0][1]!==this._drawCoords[1][1])?(this._drawCoords.length--,this._trigger("shape",e,{type:"LineString",coordinates:this._userGeodetic?t.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})):this._eventTarget_dblclick_zoom(e),this._resetDrawing();break;case"drawPolygon":case"measureArea":if(this._drawCoords.length>1&&(this._drawCoords[0][0]!==this._drawCoords[1][0]||this._drawCoords[0][1]!==this._drawCoords[1][1])){var i=this._drawCoords.length-1;i>2&&(this._drawCoords[i]=t.merge([],this._drawCoords[0]),this._trigger("shape",e,{type:"Polygon",coordinates:[this._userGeodetic?t.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]}))}else this._eventTarget_dblclick_zoom(e);this._resetDrawing();break;default:this._eventTarget_dblclick_zoom(e)}this._inOp=!1}},_eventTarget_touchstart:function(i){if(document.elementFromPoint!==e){var s=document.elementFromPoint(i.pageX,i.pageY);if(s&&"A"===s.nodeName)return}var n=this._options.mode,r=this._options.shift,o="dragBox"===n?"dragBox":"zoom";if("static"!==n&&(this._supportTouch||1===i.which)){var a=this._clearInteractiveTimeout(),h=t(i.currentTarget).offset(),c=i.originalEvent.changedTouches;if(this._supportTouch&&c?(this._multiTouchAnchor=t.merge([],c),this._isMultiTouch=this._multiTouchAnchor.length>1,this._isMultiTouch?(this._multiTouchCurrentBbox=[c[0].pageX-h.left,c[0].pageY-h.top,c[1].pageX-h.left,c[1].pageY-h.top],this._multiTouchAnchorBbox=t.merge([],this._multiTouchCurrentBbox),this._current=t.geo.center(this._multiTouchCurrentBbox,!0)):(this._multiTouchCurrentBbox=[c[0].pageX-h.left,c[0].pageY-h.top,0/0,0/0],this._current=[c[0].pageX-h.left,c[0].pageY-h.top])):this._current=[i.pageX-h.left,i.pageY-h.top],this._softDblClick){var l=t.now();if(750>l-this._downDate){if(this._isTap){var u=this._current[0]-this._anchor[0],_=this._current[1]-this._anchor[1],d=Math.sqrt(u*u+_*_);d>8?this._isTap=!1:this._current=t.merge([],this._anchor)}this._isDbltap=this._isDbltap?!1:this._isTap}else this._isDbltap=!1;this._isTap=!0,this._downDate=l}return this._mouseDown=!0,this._anchor=t.merge([],this._current),!this._inOp&&i.shiftKey&&"off"!==r?(this._shiftDown=!0,this._$eventTarget.css("cursor",this._options.cursors["default"===r?o:r])):this._isMultiTouch||!this._options.pannable&&"dragBox"!==n&&"dragCircle"!==n||(this._inOp=!0,"zoom"!==n&&"dragBox"!==n&&"dragCircle"!==n&&(this._lastDrag=this._current,i.currentTarget.setCapture&&i.currentTarget.setCapture())),i.preventDefault(),a&&this._setInteractiveTimeout(!0),!1}},_dragTarget_touchmove:function(i){if("static"!==this._options.mode){var n=!1;this._mouseDown&&(n=this._clearInteractiveTimeout());var r,o=this._$eventTarget.offset(),a=this._drawCoords.length,h=i.originalEvent.changedTouches,c=0;if(this._supportTouch&&h){if(!this._isMultiTouch&&this._mouseDown&&this._multiTouchAnchor.length>0&&h[0].identifier!==this._multiTouchAnchor[0].identifier)return this._mouseDown=!1,this._isMultiTouch=!0,this._wheelLevel=0,this._multiTouchAnchor.push(h[0]),this._multiTouchCurrentBbox=[this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1],this._multiTouchAnchor[1].pageX-o.left,this._multiTouchAnchor[1].pageY-o.top],this._multiTouchAnchorBbox=t.merge([],this._multiTouchCurrentBbox),this._mouseDown=!0,this._anchor=this._current=t.geo.center(this._multiTouchCurrentBbox,!0),n&&this._setInteractiveTimeout(!0),!1;if(this._isMultiTouch){for(;h.length>c;c++)h[c].identifier===this._multiTouchAnchor[0].identifier?(this._multiTouchCurrentBbox[0]=h[c].pageX-o.left,this._multiTouchCurrentBbox[1]=h[c].pageY-o.top):h[c].identifier===this._multiTouchAnchor[1].identifier&&(this._multiTouchCurrentBbox[2]=h[c].pageX-o.left,this._multiTouchCurrentBbox[3]=h[c].pageY-o.top);var l=t.geo._distancePointPoint([this._multiTouchAnchorBbox[0],this._multiTouchAnchorBbox[1]],[this._multiTouchAnchorBbox[2],this._multiTouchAnchorBbox[3]]),u=t.geo._distancePointPoint([this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1]],[this._multiTouchCurrentBbox[2],this._multiTouchCurrentBbox[3]]);r=t.geo.center(this._multiTouchCurrentBbox,!0);var _=(u-l)/l;_*=_>0?5:10;var d=_-this._wheelLevel;this._wheelLevel=_;var p=this._getZoomCenterAndSize(this._anchor,d,!1);this._setInteractiveCenterAndSize(p.center,p.pixelSize),this._interactiveTransform(),n=!0,r=t.geo.center(this._multiTouchCurrentBbox,!0)}else r=[i.originalEvent.changedTouches[0].pageX-o.left,i.originalEvent.changedTouches[0].pageY-o.top]}else r=[i.pageX-o.left,i.pageY-o.top];if(r[0]===this._lastMove[0]&&r[1]===this._lastMove[1]&&this._inOp)return i.preventDefault(),n&&this._setInteractiveTimeout(!0),!1;if(7===s&&(this._isDbltap=this._isTap=!1),this._mouseDown&&(this._current=r,this._moveDate=t.now()),this._isMultiTouch)return i.preventDefault(),this._isDbltap=this._isTap=!1,n&&this._setInteractiveTimeout(!0),!1;var g,f,m,v=this._options.mode,x=this._options.shift,y="dragBox"===v?"dragBox":"zoom";switch(this._shiftDown&&(v="default"===x?y:x),v){case"zoom":case"dragBox":this._mouseDown?(this._$drawContainer.geographics("clear"),this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],r[0],r[1]])):this._trigger("move",i,{type:"Point",coordinates:this.toMap(r)});break;case"dragCircle":this._mouseDown?(g=r[0]-this._anchor[0],f=r[1]-this._anchor[1],m=2*Math.sqrt(g*g+f*f),this._$drawContainer.geographics("clear"),this._$drawContainer.geographics("drawArc",this._anchor,0,360,{width:m,height:m})):this._trigger("move",i,{type:"Point",coordinates:this.toMap(r)});break;case"drawLineString":case"drawPolygon":case"measureLength":case"measureArea":this._mouseDown||this._toolPan?(this._panMove(),n=!0):(a>0&&(this._drawCoords[a-1]=this._toMap(r,this._centerInteractive,this._pixelSizeInteractive),this._drawPixels[a-1]=r,this._refreshDrawing()),this._trigger("move",i,{type:"Point",coordinates:this.toMap(r)}));break;default:this._mouseDown||this._toolPan?(this._panMove(),n=!0):this._trigger("move",i,{type:"Point",coordinates:this.toMap(r)})}return this._lastMove=r,n&&this._setInteractiveTimeout(!0),this._inOp?(i.preventDefault(),!1):e}},_dragTarget_touchstop:function(i){if("static"!==this._options.mode){if(!this._mouseDown){if(7!==s)return;this._eventTarget_touchstart(i)}var n,r,o,a,h,c,l,u=this._clearInteractiveTimeout(),_=this._mouseDown,d=this._toolPan,p=this._$eventTarget.offset(),g=this._options.mode,f=this._options.shift,m="dragBox"===g?"dragBox":"zoom";if(this._shiftDown&&(g="default"===f?m:f),this._supportTouch&&i.originalEvent.changedTouches?(n=[i.originalEvent.changedTouches[0].pageX-p.left,i.originalEvent.changedTouches[0].pageY-p.top],this._multiTouchAnchor=[],this._inOp=!1):n=[i.pageX-p.left,i.pageY-p.top],this._softDblClick&&this._isTap&&(a=n[0]-this._anchor[0],h=n[1]-this._anchor[1],8>=Math.sqrt(a*a+h*h)&&(n=t.merge([],this._anchor))),a=n[0]-this._anchor[0],h=n[1]-this._anchor[1],this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._shiftDown=this._mouseDown=this._toolPan=!1,this._isMultiTouch)return i.preventDefault(),this._isMultiTouch=!1,this._wheelLevel=0,u&&this._setInteractiveTimeout(!0),e;if(document.releaseCapture&&document.releaseCapture(),_){switch(o=t.now(),this._current=n,g){case"zoom":case"dragBox":if(0!==a||0!==h){var v=6*this._pixelSize,x=this._toMap([[Math.min(this._anchor[0],n[0]),Math.max(this._anchor[1],n[1])],[Math.max(this._anchor[0],n[0]),Math.min(this._anchor[1],n[1])]]),y=[x[0][0],x[0][1],x[1][0],x[1][1]];"zoom"===g?(v>y[2]-y[0]&&v>y[3]-y[1]&&(y=t.geo.scaleBy(this._getBbox(t.geo.center(y,!0)),.5,!0)),this._setBbox(y,!0,!0),u=!0):(l=t.geo.polygonize(y,!0),l.bbox=y,this._userGeodetic&&(l.coordinates=t.geo.proj.toGeodetic(l.coordinates),l.bbox=t.geo.proj.toGeodetic(l.bbox)),this._trigger("shape",i,l))}else"dragBox"===g&&(c=this._toMap(n),l={type:"Point",coordinates:[c[0],c[1]],bbox:[c[0],c[1],c[0],c[1]]},this._userGeodetic&&(l.coordinates=t.geo.proj.toGeodetic(l.coordinates),l.bbox=t.geo.proj.toGeodetic(l.bbox)),this._trigger("shape",i,l));this._resetDrawing();break;case"dragCircle":if(0!==a||0!==h){var w,b="image"===this._options.axisLayout,S=Math.sqrt(a*a+h*h),A=180;for(this._drawPixels.length=A+1,r=0;A>r;r++)w=360*r/A*(Math.PI/180),this._drawPixels[r]=[this._anchor[0]+Math.cos(w)*S,this._anchor[1]+Math.sin(w)*S];this._drawPixels[A]=[this._drawPixels[0][0],this._drawPixels[0][1]],c=this._toMap([[this._anchor[0]-S,this._anchor[1]+(b?-S:S)],[this._anchor[0]+S,this._anchor[1]+(b?S:-S)]]),l={type:"Polygon",coordinates:[this._toMap(this._drawPixels)],bbox:[c[0][0],c[0][1],c[1][0],c[1][1]]},this._userGeodetic&&(l.coordinates=t.geo.proj.toGeodetic(l.coordinates),l.bbox=t.geo.proj.toGeodetic(l.bbox)),this._trigger("shape",i,l),this._resetDrawing()}else c=this._toMap(n),l={type:"Point",coordinates:[c[0],c[1]],bbox:[c[0],c[1],c[0],c[1]]},this._userGeodetic&&(l.coordinates=t.geo.proj.toGeodetic(l.coordinates),l.bbox=t.geo.proj.toGeodetic(l.bbox)),this._trigger("shape",i,l);break;case"drawPoint":if(this._drawTimeout&&(window.clearTimeout(this._drawTimeout),this._drawTimeout=null),d)this._panFinalize();else if(o-this._clickDate>100){var C=this;this._drawTimeout=setTimeout(function(){C._drawTimeout&&(C._trigger("shape",i,{type:"Point",coordinates:C.toMap(n)}),C._inOp=!1,C._drawTimeout=null)},250)}break;case"drawLineString":case"drawPolygon":case"measureLength":case"measureArea":d?this._panFinalize():(r=0===this._drawCoords.length?0:this._drawCoords.length-1,this._drawCoords[r]=this._toMap(n),this._drawPixels[r]=n,(2>r||this._drawCoords[r][0]!==this._drawCoords[r-1][0]||this._drawCoords[r][1]!==this._drawCoords[r-1][1])&&(this._drawCoords[r+1]=this._toMap(n,this._centerInteractive,this._pixelSizeInteractive),this._drawPixels[r+1]=n),this._refreshDrawing());break;default:d?this._panFinalize():o-this._clickDate>100&&(this._trigger("click",i,{type:"Point",coordinates:this.toMap(n)}),this._inOp=!1)}if(this._clickDate=o,this._softDblClick&&this._isDbltap)return this._isDbltap=this._isTap=!1,u&&this._setInteractiveTimeout(!0),this._$eventTarget.trigger("dblclick",i),!1}return u&&this._setInteractiveTimeout(!0),this._inOp?(i.preventDefault(),!1):e}},_eventTarget_mousewheel:function(e,i){if("static"!==this._options.mode&&"off"!==this._options.scroll){if(e.preventDefault(),this._mouseDown)return!1;if(0!==i){this._clearInteractiveTimeout(),i=i>0?Math.ceil(i):Math.floor(i);var s=t(e.currentTarget).offset();this._anchor=[e.pageX-s.left,e.pageY-s.top];var n=this._getZoomCenterAndSize(this._anchor,i,null!==this._options.tilingScheme);this._setInteractiveCenterAndSize(n.center,n.pixelSize),this._interactiveTransform(),this._setInteractiveTimeout(!0)}return!1}}})}(jQuery),function(t){t.geo._serviceTypes.tiled=function(){return{create:function(e,i,s){var n=t.data(s,"geoServiceState");if(!n){n={loadCount:0,reloadTiles:!1};var r='<div data-geo-service="tiled" style="-webkit-transform:translateZ(0); position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0;"></div>';i.append(r),n.serviceContainer=i.children(":last"),t.data(s,"geoServiceState",n)}return n.serviceContainer},destroy:function(e,i,s){var n=t.data(s,"geoServiceState");n.serviceContainer.remove(),t.removeData(s,"geoServiceState")},interactiveTransform:function(e,i,s,n){var r=t.data(i,"geoServiceState"),o=e.options.tilingScheme;r&&(this._cancelUnloaded(e,i),r.serviceContainer.children().each(function(){var i=t(this),r=i.data("pixelSize"),a=r/n;if(r>0){a=Math.round(1e3*a)/1e3;var h=i.data("scaleOrigin"),c=e._toPixel(h,s,n);i.css({left:Math.round(c[0])+"px",top:Math.round(c[1])+"px",width:o.tileWidth*a,height:o.tileHeight*a})}}))},refresh:function(e,i,s){var n=t.data(i,"geoServiceState");if(this._cancelUnloaded(e,i),n&&s&&(n.reloadTiles=!0),n&&i&&"visible"===i.style.visibility&&!n.serviceContainer.is(":hidden")){var r,o,a=e._getBbox(),h=e._pixelSize,c=this,l=n.serviceContainer,u="image"===e.options.axisLayout,_=u?1:-1,d=e.options.tilingScheme,p=d.tileWidth,g=d.tileHeight,f=Math.floor((a[0]-d.origin[0])/(h*p)),m=Math.max(Math.floor((u?a[1]-d.origin[1]:d.origin[1]-a[3])/(h*g)),0),v=Math.ceil((a[2]-d.origin[0])/(h*p)),x=Math.ceil((u?a[3]-d.origin[1]:d.origin[1]-a[1])/(h*g)),y=e._getBboxMax(),w=e._getPixelSize(0),b=w/h,S=Math.floor((y[0]-d.origin[0])/(w*p))*b,A=Math.floor((d.origin[1]+_*y[3])/(w*g))*b,C=d.origin[0]+S*p*h,T=d.origin[1]+_*A*g*h,M=Math.round((C-a[0])/h),P=Math.round((u?T-a[1]:a[3]-T)/h),$=l.children().show(),I=$.filter("[data-pixel-size='"+h+"']").appendTo(l),z=i.style.opacity,k=function(i){c._loadImage(t.data(this,"img"),i,h,e,n,z)},E=function(){t.data(this,"img").remove(),n.loadCount--,e._requestComplete()};for(n.reloadTiles&&$.find("img").attr("data-dirty","true"),I.size()?(I.css({left:M%p+"px",top:P%g+"px"}).data("scaleOrigin",e._toMap([M%p,P%g])),I.children().each(function(){var e=t(this),i=e.attr("data-tile").split(",");e.css({left:Math.round(100*(parseInt(i[0],10)-S)+100*((M-M%p)/p))+"%",top:Math.round(100*(parseInt(i[1],10)-A)+100*((P-P%g)/g))+"%"}),1>z&&e.fadeTo(0,z)})):(l.append("<div style='-webkit-transform:translateZ(0);position:absolute; left:"+M%p+"px; top:"+P%g+"px; width:"+p+"px; height:"+g+"px; margin:0; padding:0;' data-pixel-size='"+h+"'></div>"),I=l.children(":last").data("scaleOrigin",e._toMap([M%p,P%g]))),r=f;v>r;r++)for(o=m;x>o;o++){var O=""+r+","+o,L=I.children("[data-tile='"+O+"']").removeAttr("data-dirty");if(0===L.size()||n.reloadTiles){var D,G=[d.origin[0]+r*p*h,d.origin[1]+_*o*g*h],j=[d.origin[0]+((r+1)*p-1)*h,d.origin[1]+_*((o+1)*g-1)*h],B=[G[0],G[1],j[0],j[1]],R=i.hasOwnProperty("src")?"src":"getUrl",F={bbox:B,width:p,height:g,zoom:e._getZoom(),tile:{row:o,column:r},index:Math.abs(o+r)},N=t.isFunction(i[R]);if(N?D=i[R](F):(t.templates("geoSrc",i[R]),D=t.render.geoSrc(F)),n.loadCount++,e._requestQueued(),n.reloadTiles&&L.size()>0)L.attr("src",D);else{var V="<img style='-webkit-transform:translateZ(0);position:absolute; left:"+(100*(r-S)+100*((M-M%p)/p))+"%; "+"top:"+(100*(o-A)+100*((P-P%g)/g))+"%; ";V+="width: 100%; height: 100%;",V+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+O+"' />",I.append(V),L=I.children(":last")}"string"==typeof D?c._loadImage(L,D,h,e,n,z):D?(t.data(D,"img",L),D.done(k).fail(E)):L.remove()}}$.find("[data-dirty]").remove(),n.reloadTiles=!1}},resize:function(){},opacity:function(e,i){var s=t.data(i,"geoServiceState");s.serviceContainer.find("img").stop(!0).fadeTo("fast",i.style.opacity)},toggle:function(e,i){var s=t.data(i,"geoServiceState");s.serviceContainer.css("display","visible"===i.style.visibility?"block":"none")},_cancelUnloaded:function(e,i){var s=t.data(i,"geoServiceState");if(s&&s.loadCount>0)for(s.serviceContainer.find("img:hidden").remove();s.loadCount>0;)s.loadCount--,e._requestComplete()},_loadImage:function(e,i,s,n,r,o){var a=r.serviceContainer;e.load(function(e){1>o?t(e.target).fadeTo(0,o):t(e.target).show(),r.loadCount--,n._requestComplete(),0>=r.loadCount&&(a.children(":not([data-pixel-size='"+s+"'])").remove(),r.loadCount=0)}).error(function(e){t(e.target).remove(),r.loadCount--,n._requestComplete(),0>=r.loadCount&&(a.children(":not([data-pixel-size='"+s+"'])").remove(),r.loadCount=0)}).attr("src",i)}}}()}(jQuery),function(t){t.geo._serviceTypes.shingled=function(){return{create:function(e,i,s){var n=t.data(s,"geoServiceState");if(!n){n={loadCount:0};var r='<div data-geo-service="shingled" style="-webkit-transform:translateZ(0);position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0;"></div>';i.append(r),n.serviceContainer=i.children(":last"),t.data(s,"geoServiceState",n)}return n.serviceContainer},destroy:function(e,i,s){var n=t.data(s,"geoServiceState");n.serviceContainer.remove(),t.removeData(s,"geoServiceState")},interactiveTransform:function(e,i,s,n){var r=t.data(i,"geoServiceState"),o=e._getContentBounds(),a=o.width,h=o.height;r&&(this._cancelUnloaded(e,i),r.serviceContainer.children().each(function(){var i=t(this),r=i.data("pixelSize"),o=r/n;if(r>0){o=Math.round(1e3*o)/1e3;var c=i.data("origin"),l=e._toPixel(c,s,n);i.css({left:Math.round(l[0]),top:Math.round(l[1]),width:a*o,height:h*o})}}))},refresh:function(e,i){var s=t.data(i,"geoServiceState");if(this._cancelUnloaded(e,i),s&&i&&"visible"===i.style.visibility&&!s.serviceContainer.is(":hidden")){var n,r=e._getBbox(),o=e._pixelSize,a=this,h=s.serviceContainer,c=e._getContentBounds(),l=c.width,u=c.height,_=h.children('[data-pixel-size="'+o+'"]'),d=i.style.opacity;1>d&&h.find("img").attr("data-keep-alive","0"),_.size()||(h.append('<div style="-webkit-transform:translateZ(0);position:absolute; left:0px; top: 0px; width:'+l+"px; height:"+u+'px; margin:0; padding:0;" data-pixel-size="'+o+'" data-origin="['+e._toMap([0,0])+']"></div>'),_=h.children(":last"));var p,g=i.hasOwnProperty("src")?"src":"getUrl",f={bbox:r,width:l,height:u,zoom:e._getZoom(),tile:null,index:0},m=t.isFunction(i[g]),v=_.position();v.left=-v.left,v.top=-v.top,m?p=i[g](f):(t.templates("geoSrc",i[g]),p=t.render.geoSrc(f)),s.loadCount++,e._requestQueued(),_.append('<img style="-webkit-transform:translateZ(0);position:absolute; left:'+100*(v.left/_.width())+"%; top:"+100*(v.top/_.height())+'%; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />'),n=_.children(":last").data("center",e._center),"string"==typeof p?a._loadImage(n,p,o,e,s,d):p.done(function(t){a._loadImage(n,t,o,e,s,d)}).fail(function(){n.remove(),s.loadCount--,e._requestComplete()})}},resize:function(e,i){var s=t.data(i,"geoServiceState");if(s&&i&&"visible"===i.style.visibility){this._cancelUnloaded(e,i);var n=s.serviceContainer,r=e._getContentBounds(),o=r.width,a=r.height,h=n.children();h.attr("data-pixel-size","0"),h.each(function(){var e=t(this),i=e.position();e.css({left:i.left+(o-e.width())/2,top:i.top+(a-e.height())/2})})}},opacity:function(e,i){var s=t.data(i,"geoServiceState");s.serviceContainer.find("img").stop(!0).fadeTo("fast",i.style.opacity)},toggle:function(e,i){var s=t.data(i,"geoServiceState");s.serviceContainer.css("display","visible"===i.style.visibility?"block":"none")},_cancelUnloaded:function(e,i){var s=t.data(i,"geoServiceState");if(s&&s.loadCount>0)for(s.serviceContainer.find("img:hidden").remove();s.loadCount>0;)s.loadCount--,e._requestComplete()},_loadImage:function(e,i,s,n,r,o){var a=r.serviceContainer;e.load(function(e){t.contains(document.body,e.target.jquery?e.target[0]:e.target)&&(1>o?t(e.target).fadeTo(0,o):t(e.target).show(),r.loadCount--,n._requestComplete(),0>=r.loadCount&&(a.children(':not([data-pixel-size="'+s+'"])').remove(),a.find("img[data-keep-alive]").remove(),r.loadCount=0))}).error(function(e){t.contains(document.body,e.target.jquery?e.target[0]:e.target)&&(t(e.target).remove(),r.loadCount--,n._requestComplete(),0>=r.loadCount&&(a.children(":not([data-pixel-size='"+s+"'])").remove(),r.loadCount=0))}).attr("src",i)}}}()}(jQuery);