(function(d){function k(h){var e=[].slice.call(arguments,1),g=0;h=d.event.fix(h||window.event);h.type="mousewheel";if(h.wheelDelta)g=h.wheelDelta/120;if(h.detail)g=-h.detail/3;e.unshift(h,g);return d.event.handle.apply(this,e)}var n=["DOMMouseScroll","mousewheel"];d.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var h=n.length;h;)this.addEventListener(n[--h],k,false);else this.onmousewheel=k},teardown:function(){if(this.removeEventListener)for(var h=n.length;h;)this.removeEventListener(n[--h],
k,false);else this.onmousewheel=null}};d.fn.extend({mousewheel:function(h){return h?this.bind("mousewheel",h):this.trigger("mousewheel")},unmousewheel:function(h){return this.unbind("mousewheel",h)}})})(jQuery);
(function(d,k){var n=Array.prototype.slice,h=d.cleanData;d.cleanData=function(e){for(var g=0,j;(j=e[g])!=null;g++)d(j).triggerHandler("remove");h(e)};d.widget=function(e,g,j){var p=e.split(".")[0],l;e=e.split(".")[1];l=p+"-"+e;if(!j){j=g;g=d.Widget}d.expr[":"][l]=function(s){return!!d.data(s,e)};d[p]=d[p]||{};d[p][e]=d.extend(function(s,w){if(!this._createWidget)return new d[p][e](s,w);arguments.length&&this._createWidget(s,w)},d[p][e]);var v=new g;v.options=d.extend(true,{},v.options);d.each(j,function(s,
w){if(d.isFunction(w))j[s]=function(){var E=function(a){return g.prototype[a].apply(this,n.call(arguments,1))},J=function(a,b){return g.prototype[a].apply(this,b)};return function(){var a=this._super,b=this._superApply,f;this._super=E;this._superApply=J;f=w.apply(this,arguments);this._super=a;this._superApply=b;return f}}()});d[p][e].prototype=d.extend(true,v,{namespace:p,widgetName:e,widgetEventPrefix:e,widgetBaseClass:l},j);d.widget.bridge(e,d[p][e])};d.widget.bridge=function(e,g){d.fn[e]=function(j){var p=
typeof j==="string",l=n.call(arguments,1),v=this;j=!p&&l.length?d.extend.apply(null,[true,j].concat(l)):j;p?this.each(function(){var s=d.data(this,e);if(!s)return d.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+j+"'");if(!d.isFunction(s[j])||j.charAt(0)==="_")return d.error("no such method '"+j+"' for "+e+" widget instance");var w=s[j].apply(s,l);if(w!==s&&w!==k){v=w;return false}}):this.each(function(){var s=d.data(this,e);s?s.option(j||{})._init():g(j,
this)});return v}};d.Widget=function(e,g){if(!this._createWidget)return new d[namespace][name](e,g);arguments.length&&this._createWidget(e,g)};d.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(e,g){g=d(g||this.defaultElement||this)[0];this.element=d(g);this.options=d.extend(true,{},this.options,this._getCreateOptions(),e);this.bindings=d();this.hoverable=d();this.focusable=d();if(g!==this){d.data(g,this.widgetName,this);
this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return d.metadata&&d.metadata.get(this.element[0])[this.widgetName]},_create:d.noop,_init:d.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:d.noop,widget:function(){return this.element},option:function(e,g){var j=e;if(arguments.length===0)return d.extend({},this.options);if(typeof e==="string"){if(g===k)return this.options[e];j={};j[e]=g}this._setOptions(j);return this},_setOptions:function(e){var g=this;d.each(e,function(j,p){g._setOption(j,p)});return this},_setOption:function(e,g){this.options[e]=g;if(e==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!g).attr("aria-disabled",g);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(e,g){if(g){e=d(e);this.bindings=this.bindings.add(e)}else{g=e;e=this.element}var j=this;d.each(g,function(p,l){e.bind(p+"."+j.widgetName,function(){if(!(j.options.disabled===true||d(this).hasClass("ui-state-disabled")))return(typeof l===
"string"?j[l]:l).apply(j,arguments)})})},_hoverable:function(e){this.hoverable=this.hoverable.add(e);this._bind(e,{mouseenter:function(g){d(g.currentTarget).addClass("ui-state-hover")},mouseleave:function(g){d(g.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e);this._bind(e,{focusin:function(g){d(g.currentTarget).addClass("ui-state-focus")},focusout:function(g){d(g.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,g,j){var p=
this.options[e];g=d.Event(g);g.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase();j=j||{};if(g.originalEvent){e=d.event.props.length;for(var l;e;){l=d.event.props[--e];g[l]=g.originalEvent[l]}}this.element.trigger(g,j);j=d.isArray(j)?[g].concat(j):[g,j];return!(d.isFunction(p)&&p.apply(this.element[0],j)===false||g.isDefaultPrevented())}}})(jQuery);
(function(d){d.geo={_center:function(k){return[(k[0]+k[2])/2,(k[1]+k[3])/2]},_expandBy:function(k,n,h){k=this._center(k);return[k[0]-n,k[1]-h,k[0]+n,k[1]+h]},_height:function(k){return k[3]-k[1]},_reaspect:function(k,n){var h=this._width(k),e=this._height(k);this._center(k);if(h==0||e==0||n<=0)return k;if(h/e>n){h=h/2;e=h/n}else{e=e/2;h=e*n}return[c[0]-h,c[1]-e,c[0]+h,c[1]+e]},_scaleBy:function(k,n){return this._expandBy(k,this._width(k)*n/2,this._height(k)*n/2)},_width:function(k){return k[2]-k[0]}}})(jQuery,
this);
(function(d,k){var n="center",h="pixelSize",e={},g,j,p,l,v,s,w=function(){for(var a=5,b=document.createElement("div"),f=b.all||[];b.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",f[0];);return a>6?a:!a}(),E=this._supportTouch||this._ieVersion==7,J={bbox:[-180,-90,180,90],bboxMax:[-180,-90,180,90],center:[0,0],cursors:{pan:"move"},mode:"pan",pixelSize:156543.03392799935,services:[{id:"OSM",type:"tiled",getUrl:function(a){return"http://tile.openstreetmap.org/"+a.zoom+"/"+a.tile.column+"/"+a.tile.row+
".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA",visible:true}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},zoom:0,_serviceTypes:{tiled:{create:function(a,b,f){if(this[b.id]==null){this[b.id]={loadCount:0,reloadTiles:false,serviceContainer:null};a='<div data-service="'+b.id+'" style="position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0; display:'+(b.visible?"block":"none")+
';"></div>';f!=null?d(j.children()[f]).before(a):j.append(a);this[b.id].serviceContainer=j.children('[data-service="'+b.id+'"]')}},destroy:function(a,b){this[b.id].serviceContainer.remove();delete this[b.id]},interactivePan:function(a,b,f,o){this._cancelUnloaded(a,b);this[b.id].serviceContainer.children().css({left:function(m,r){return parseInt(r)+f},top:function(m,r){return parseInt(r)+o}})},interactiveScale:function(){},refresh:function(a,b){if(b!=null&&this[b.id]!=null&&b.visible){this._cancelUnloaded(a,
b);var f=this[b.id],o=f.serviceContainer,m=h,r=a._bbox(),u=a.options.tilingScheme,q=u.tileWidth,t=u.tileHeight,x=Math.floor((r[0]-u.origin[0])/(m*q)),F=Math.floor((u.origin[1]-r[3])/(m*t)),K=Math.ceil((r[2]-u.origin[0])/(m*q)),P=Math.ceil((u.origin[1]-r[1])/(m*t)),z=a._bboxMax(),y=a._tiledPixelSize(0),G=y/m,L=Math.floor((z[0]-u.origin[0])/(y*q))*G,M=Math.floor((u.origin[1]-z[3])/(y*t))*G,B=Math.round((u.origin[0]+L*q*m-r[0])/m),C=Math.round((r[3]-(u.origin[1]-M*t*m))/m);r=o.children().show();z=r.filter('[data-pixelSize="'+
m+'"]').appendTo(o);var I=b.opacity==null?1:b.opacity;f.reloadTiles&&r.find("img").attr("data-dirty","true");if(z.size()===0){o.append('<div style="position:absolute; left:'+B%q+"px; top:"+C%t+"px; width:"+q+"px; height:"+t+'px; margin:0; padding:0;" data-pixelSize="'+m+'"></div>');z=o.children(":last").data("scaleOrigin",B%q+","+C%t)}else{z.css({left:B%q+"px",top:C%t+"px"}).data("scaleOrigin",B%q+","+C%t);z.children().each(function(){var D=d(this),N=D.attr("data-tile").split(",");D.css({left:Math.round((parseInt(N[0])-
L)*100+(B-B%q)/q*100)+"%",top:Math.round((parseInt(N[1])-M)*100+(C-C%t)/t*100)+"%"});I<1&&D.fadeTo(0,I)})}for(x=x;x<K;x++)for(y=F;y<P;y++){G=""+x+","+y;var A=z.children('[data-tile="'+G+'"]');A.removeAttr("data-dirty");if(A.size()===0||f.reloadTiles){var H=[u.origin[0]+x*q*m,u.origin[1]-y*t*m],O=[u.origin[0]+((x+1)*q-1)*m,u.origin[1]-((y+1)*t-1)*m];H=b.getUrl({bbox:[H[0],H[1],O[0],O[1]],width:q,height:t,zoom:a._zoom(),tile:{row:y,column:x}});f.loadCount++;if(f.reloadTiles&&A.size()>0)A.attr("src",
H);else{A='<img style="position:absolute; left:'+((x-L)*100+(B-B%q)/q*100)+"%; top:"+((y-M)*100+(C-C%t)/t*100)+"%; ";if(d("body")[0].filters===k)A+="width: 100%; height: 100%;";A+='margin:0; padding:0; -moz-user-select:none; display:none;" unselectable="on" data-tile="'+G+'" />';z.append(A);A=z.children(":last");A.load(function(D){I<1?d(D.target).fadeTo(0,I):d(D.target).show();f.loadCount--;if(f.loadCount<=0){o.children(':not([data-pixelSize="'+m+'"])').remove();f.loadCount=0}}).error(function(D){d(D.target).remove();
f.loadCount--;if(f.loadCount<=0){o.children(':not([data-pixelSize="'+m+'"])').remove();f.loadCount=0}}).attr("src",H)}}}r.find("[data-dirty]").remove();f.reloadTiles=false}},_cancelUnloaded:function(a,b){var f=this[b.id],o=f.serviceContainer;if(f.loadCount>0)for(o.find("img:hidden").remove();f.loadCount>0;)f.loadCount--},_onOpacityChanged:function(){}}}};d.widget("geo.geomap",function(){return{options:d.extend({},J),_create:function(){var a=this.element,b=a.css("position");b!="relative"&&b!="absolute"&&
b!="fixed"&&a.css("position","relative");a.css("text-align","left");b=this._mapSize();e={x:parseInt(a.css("padding-left")),y:parseInt(a.css("padding-top")),width:b.width,height:b.height};this._createChildren();n=v=[0,0];h=s=156543.03392799935;this._mouseDown=this._inOp=this._toolPan=this._shiftZoom=this._panning=this._isTap=this._isDbltap=false;this._anchor=this._current=this._lastMove=this._lastDrag=this._velocity=[0,0];this._friction=[0.8,0.8];this._downDate=this._moveDate=this._clickDate=0;var f=
(this._supportTouch="ontouchend"in document)?"touchstart":"mousedown";a=this._supportTouch?"touchend touchcancel":"mouseup";b=this._supportTouch?"touchmove":"mousemove";l.dblclick(d.proxy(this._eventTarget_dblclick,this));l.bind(f,d.proxy(this._eventTarget_touchstart,this));f=l[0].setCapture?l:d(document);f.bind(b,d.proxy(this._dragTarget_touchmove,this));f.bind(a,d.proxy(this._dragTarget_touchstop,this));l.mousewheel(d.proxy(this._eventTarget_mousewheel,this));this._createServices();this._refresh()},
_setOption:function(){d.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){d.Widget.prototype.destroy.apply(this,arguments);this.element.html("")},_bbox:function(){var a=e.width/2*h,b=e.height/2*h;return[n[0]-a,n[1]-b,n[0]+a,n[1]+b]},_bboxMax:function(){var a=e.width/2*s,b=e.height/2*s;return[v[0]-a,v[1]-b,v[0]+a,v[1]+b]},_createChildren:function(){var a=this.element,b=a.children().detach();b.css("-moz-user-select","none");a.prepend('<div style="position:absolute; left:'+e.x+"px; top:"+
e.y+"px; width:"+e.width+"px; height:"+e.height+'px; margin:0; padding:0; overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;" unselectable="on"></div>');l=g=a.children(":first");g.append('<div style="position:absolute; left:0; top:0; width:'+e.width+"px; height:"+e.height+'px; margin: 0; padding: 0;"></div>');j=g.children(":last");g.append('<div style="position:absolute; left:0; top:0; width:'+e.width+"px; height:"+e.height+'px; margin: 0; padding: 0;"></div>');
g.children(":last");g.append('<div class="ui-widget ui-widget-content ui-corner-all" style="position:absolute; left:0; top:0px; max-width:128px; display:none;"><div style="margin:.2em;"></div></div>');p=g.children(":last");p.children();g.append(b)},_createServices:function(){for(var a=this.options,b=0;b<a.services.length;b++)a._serviceTypes[a.services[b].type].create(this,a.services[b])},_mapSize:function(){for(var a={width:0,height:0},b=this.element;b.size()&&!(a.width>0&&a.height>0);){a={width:b.width(),
height:b.height()};if(a.width<=0||a.height<=0)a={width:parseInt(b.css("width")),height:parseInt(b.css("height"))};b=b.parent()}return a},_panEnd:function(){this._velocity=[this._velocity[0]>0?Math.floor(this._velocity[0]*this._friction[0]):Math.ceil(this._velocity[0]*this._friction[0]),this._velocity[1]>0?Math.floor(this._velocity[1]*this._friction[1]):Math.ceil(this._velocity[1]*this._friction[1])];if(Math.abs(this._velocity[0])<4&&Math.abs(this._velocity[1])<4)this._panFinalize();else{this._current=
[this._current[0]+this._velocity[0],this._current[1]+this._velocity[1]];this._panMove();setTimeout(d.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(this._panning){this._velocity=[0,0];var a=this.options;this._setCenterAndSize([n[0]+-(this._current[0]-this._anchor[0])*h,n[1]+(this._current[1]-this._anchor[1])*h],h,true);this._inOp=false;this._anchor=this._current;this._toolPan=this._panning=false;l.css("cursor",a.cursors[a.mode])}},_panMove:function(){var a=this.options,b=this._current[0]-
this._lastDrag[0],f=this._current[1]-this._lastDrag[1];if(isNaN(b)||isNaN(f))debugger;if(this._toolPan||b>3||b<-3||f>3||f<-3){if(!this._toolPan){this._toolPan=true;l.css("cursor",a.cursors.pan)}if(this._mouseDown)this._velocity=[b,f];if(b!=0||f!=0){this._panning=true;this._lastDrag=this._current;for(i=0;i<a.services.length;i++){var o=a.services[i];a._serviceTypes[o.type].interactivePan(this,o,b,f)}}}},_refresh:function(){for(var a=this.options,b=0;b<a.services.length;b++){var f=a.services[b];!this._mouseDown&&
a._serviceTypes[f.type]!=null&&a._serviceTypes[f.type].refresh(this,f)}},_setCenterAndSize:function(a,b,f){var o=this.options;if(h!=b)for(var m=0;m<o.services.length;m++){var r=o.services[m];o._serviceTypes[r.type].interactiveScale(this,r,a,b)}n=a;h=b;if(typeof f==="undefined"||f)this._refresh()},_tiledPixelSize:function(a){var b=this.options.tilingScheme;if(b!=null){if(a===0)return b.pixelSizes!=null?b.pixelSizes[0]:b.basePixelSize;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,(b.pixelSizes!=null?
b.pixelSizes.length:b.levels)-1);return b.pixelSizes!=null?b.pixelSizes[a]:b.basePixelSize/Math.pow(2,a)}else return NaN},_tiledZoom:function(a){var b=this.options.tilingScheme;if(b.pixelSizes!=null){a=Math.round(a);for(var f=(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1;f>=0;f--)if(Math.round(b.pixelSizes[f])>=a)return f;return 0}else return Math.max(Math.round(Math.log(b.basePixelSize/a)/Math.log(2)),0)},_toMap:function(a,b,f){var o=d.isArray(a[0]);o||(a=[a]);b=b||n;f=f||h;var m=e.width,r=
e.height,u=m/2*f;f=r/2*f;var q=[b[0]-u,b[1]-f,b[0]+u,b[1]+f],t=d.geo._width(q)/m,x=d.geo._height(q)/r,F=[];d.each(a,function(K){F[K]=[q[0]+this[0]*t,q[3]-this[1]*x]});return o?F:F[0]},_zoom:function(){if(this.options.tilingScheme!=null)return this._tiledZoom(h);else{var a=e.width/e.height,b=d.geo._reaspect(this._bbox(),a);a=d.geo._reaspect(this._bboxMax(),a);return Math.log(d.geo._width(a)/d.geo._width(b))/Math.log(2)}},_zoomTo:function(a,b){b=b<0?0:b;var f=this._tiledPixelSize(b);if(isNaN(f)){f=
d.geo._scaleBy(this._bboxMax(),1/Math.pow(2,b));f=Math.max(d.geo._width(f)/e.width,d.geo._height(f)/e.height);this._setCenterAndSize(a,f,true)}else this._setCenterAndSize(a,f,true)},_eventTarget_dblclick:function(a){this._panFinalize();var b=this.options;d(a.currentTarget).offset();switch(b.mode){case "pan":this._zoomTo(this._toMap(this._current),this._zoom()+1)}this._inOp=false},_eventTarget_touchstart:function(a){if(!(!this._supportTouch&&a.which!=1)){var b=this.options;if(E){var f=d.now();this._isDbltap=
f-this._downDate<750?this._isDbltap?false:this._isTap:false;this._isTap=true;this._downDate=f}a.preventDefault();this._panFinalize();f=d(a.currentTarget).offset();this._current=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-f.left,a.originalEvent.changedTouches[0].pageY-f.top]:[a.pageX-f.left,a.pageY-f.top];this._mouseDown=true;this._anchor=this._current;if(!this._inOp&&a.shiftKey){this._shiftZoom=true;l.css("cursor",b.cursors.zoom)}else{this._inOp=true;switch(b.mode){case "pan":this._lastDrag=
this._current;a.currentTarget.setCapture&&a.currentTarget.setCapture()}}return false}},_dragTarget_touchmove:function(a){var b=this.options,f=l.offset();a=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-f.left,a.originalEvent.changedTouches[0].pageY-f.top]:[a.pageX-f.left,a.pageY-f.top];if(!(a[0]==this._lastMove[0]&&a[1]==this._lastMove[1])){if(E)this._isDbltap=this._isTap=false;if(this._mouseDown){this._current=a;this._moveDate=d.now()}switch(this._shiftZoom?"zoom":b.mode){case "pan":this._mouseDown&&
this._panMove()}this._lastMove=a}},_dragTarget_touchstop:function(a){!this._mouseDown&&w==7&&this._eventTarget_touchstart(a);var b=this.options,f=this._mouseDown,o=l.offset();o=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-o.left,a.originalEvent.changedTouches[0].pageY-o.top]:[a.pageX-o.left,a.pageY-o.top];var m=this._shiftZoom?"zoom":b.mode;l.css("cursor",b.cursors[m]);this._shiftZoom=this._mouseDown=this._toolPan=false;document.releaseCapture&&document.releaseCapture();if(f){b=d.now();
this._current=o;switch(m){case "pan":b-this._moveDate>500?this._panFinalize():this._panEnd()}this._clickDate=b;if(E&&this._isDbltap){this._isDbltap=this._isTap=false;l.trigger("dblclick",a)}}},_eventTarget_mousewheel:function(){}}}())})(jQuery);
